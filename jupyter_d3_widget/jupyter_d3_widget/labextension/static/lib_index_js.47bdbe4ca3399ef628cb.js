(self["webpackChunkjupyter_d3_widget"] = self["webpackChunkjupyter_d3_widget"] || []).push([["lib_index_js"],{

/***/ "./node_modules/css-loader/dist/cjs.js!./lib/comparison_map.css":
/*!**********************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js!./lib/comparison_map.css ***!
  \**********************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../node_modules/css-loader/dist/runtime/api.js */ "./node_modules/css-loader/dist/runtime/api.js");
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__);
// Imports

var ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default()(true);
// Module
___CSS_LOADER_EXPORT___.push([module.id, ".body_cripav{\n\twidth:100%; height:100%;\n\tpadding: 10px;\n\tfont-family: Verdana, sans-serif;\n\tcolor:#40403f;\n\tbackground-color: #EDF2F8;\n}\n\n.navbar_cripav{\n\twidth:100%;\n\theight: 60px;\n\tdisplay: flex;\n\tjustify-content: center;\n  align-items: center;\n}\n\n.navbar_elem{\n  width:35%;\n  text-align: center;\n}\n\n.horizontal_bar{\n\twidth:3%;\n\theight: 25%;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.btn_navbar{\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-family: Verdana, sans-serif;\n\tcursor:pointer;\n\tborder-radius: 10px;\n\tbackground-color: #f1f1f1;\n\tbox-shadow: 0 2px 5px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12);\n\tmargin-bottom: 5px;\n}\n\n\n.btn_navbar:hover {\n \tbackground-color: #e2e2e2;\n\n}\n\n.btn_navbar:active {\n \tbackground-color:  #d3d4d4;\n}\n\n.btn_run{\n\tbackground-color: white;\n\tbox-shadow: 0 2px 5px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12);\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-family: Verdana, sans-serif;\n\tcursor:pointer;\n\tborder-radius: 10spx;\n\tborder:1px solid black;\n\tmargin:10px;\n}\n\n\n.btn_run:hover {\n \tbackground-color: #E1E4E8;\n}\n\n.btn_run:active {\n \tbackground-color:  #C7C9CE;\n}\n\n\n.row{\n\twidth:100%;\n\theight: 325px;\n\tdisplay: flex;\n\tmargin-top: 5px;\n\tmargin-bottom: 5px;\n}\n\n.content{\n\twidth:100%;\n\theight:100%;\n\tmargin-left:7px;\n\tmargin-right:7px;\n\tborder-radius: 15px;\n\tbackground-color: #f1f1f1 !important;\n\tbox-shadow: 0 2px 5px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12);\n}\n\n.column{\n\twidth:100%;\n\theight:100%;\n\tfont-family: Verdana, sans-serif;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.element_visible{\n\tdisplay: block;\n}\n\n.element_hidden{\n\tdisplay: none;\n}\n\n.line-label{\n\tfont-family: Verdana, sans-serif;\n}\n\n.line-label:hover {\n  color:#40403f;\n  cursor:pointer;\n}\n\n.footer_cripav{\n\twidth:100%;\n\theight: 100%;\n\tdisplay: flex;\n}\n\n.footer_info {\n\tjustify-content: center;\n\talign-items: center;\n\tdisplay:flex;\n\twidth:100%;\n\tfont-family: Verdana, sans-serif;\n\tfont-size: 13px;\n}\n\n.centered {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  text-align: center;\n}\n\n.class0 {\n  fill: rgb(242, 142, 44); stroke: rgb(242, 142, 44);\n}\n.class1 {\n  fill: rgb(225, 87, 89); stroke: rgb(225, 87, 89);\n}\n.class2 {\n  fill: rgb(118, 183, 178); stroke: rgb(118, 183, 178);\n}\n.class3 {\n  fill: rgb(89, 161, 79); stroke: rgb(89, 161, 79);\n}\n.class4 {\n  fill: rgb(237, 201, 73); stroke: rgb(237, 201, 73);\n}\n.class5 {\n  fill: rgb(175, 122, 161); stroke: rgb(175, 122, 161);\n}\n.class6 {\n  fill: rgb(255, 157, 167); stroke: rgb(255, 157, 167);\n}\n.class7 {\n  fill: rgb(156, 117, 95); stroke: rgb(156, 117, 95);\n}\n.class8 {\n  fill: rgb(186, 176, 171); stroke: rgb(186, 176, 171);\n}\n.class9 {\n  fill: rgb(127, 201, 127); stroke: rgb(127, 201, 127);\n}\n.class10 {\n  fill: rgb(190, 174, 212); stroke: rgb(190, 174, 212);\n}\n.class11 {\n  fill: rgb(253, 192, 134); stroke: rgb(253, 192, 134);\n}\n.class12 {\n  fill: rgb(255, 255, 153); stroke: rgb(255, 255, 153);\n}\n.class13 {\n  fill: rgb(245, 34, 206); stroke: rgb(245, 34, 206);\n}\n.class14 {\n  fill: rgb(145,182,255); stroke: rgb(145,182,255);\n}\n.class15 {\n  fill: rgb(67, 247, 244); stroke: rgb(67, 247, 244);\n}\n.class16 {\n  fill: rgb(15, 82, 2); stroke: rgb(15, 82, 2);\n}\n.class-1 {\n  fill: rgb(84, 75, 66); stroke: rgb(84, 75, 66);\n}\n\n.class-non-hotspot {\n  fill: #219fff; stroke: #219fff;\n}\n\n.class-hotspot {\n  fill: #ff2921; stroke: #ff2921;\n}\n\n\n\n@keyframes spinnert {\n  to {transform: rotate(360deg);}\n}\n \n.spinner1{\n  content: '';\n  box-sizing: border-box;\n  position: absolute;\n  top: 17%;\n  left: 75%;\n  width: 100px;\n  height: 100px;\n  margin-top: -10px;\n  margin-left: -10px;\n  border-radius: 50%;\n  border: 5px solid #ccc;\n  border-top-color: #b0ccff;\n  animation: spinnert 0.8s linear infinite;\n}\n\n.spinner2{\n  content: '';\n  box-sizing: border-box;\n  position: absolute;\n  top: 75%;\n  left: 50%;\n  width: 100px;\n  height: 100px;\n  margin-top: -10px;\n  margin-left: -10px;\n  border-radius: 50%;\n  border: 5px solid #ccc;\n  border-top-color: #b0ccff;\n  animation: spinnert 0.8s linear infinite;\n}", "",{"version":3,"sources":["webpack://lib/comparison_map.css"],"names":[],"mappings":"AAAA;CACC,UAAU,EAAE,WAAW;CACvB,aAAa;CACb,gCAAgC;CAChC,aAAa;CACb,yBAAyB;AAC1B;;AAEA;CACC,UAAU;CACV,YAAY;CACZ,aAAa;CACb,uBAAuB;EACtB,mBAAmB;AACrB;;AAEA;EACE,SAAS;EACT,kBAAkB;AACpB;;AAEA;CACC,QAAQ;CACR,WAAW;CACX,aAAa;CACb,sBAAsB;AACvB;;AAEA;CACC,WAAW;CACX,YAAY;CACZ,aAAa;CACb,uBAAuB;CACvB,mBAAmB;CACnB,gCAAgC;CAChC,cAAc;CACd,mBAAmB;CACnB,yBAAyB;CACzB,sEAAsE;CACtE,kBAAkB;AACnB;;;AAGA;EACE,yBAAyB;;AAE3B;;AAEA;EACE,0BAA0B;AAC5B;;AAEA;CACC,uBAAuB;CACvB,sEAAsE;CACtE,WAAW;CACX,YAAY;CACZ,aAAa;CACb,uBAAuB;CACvB,mBAAmB;CACnB,gCAAgC;CAChC,cAAc;CACd,oBAAoB;CACpB,sBAAsB;CACtB,WAAW;AACZ;;;AAGA;EACE,yBAAyB;AAC3B;;AAEA;EACE,0BAA0B;AAC5B;;;AAGA;CACC,UAAU;CACV,aAAa;CACb,aAAa;CACb,eAAe;CACf,kBAAkB;AACnB;;AAEA;CACC,UAAU;CACV,WAAW;CACX,eAAe;CACf,gBAAgB;CAChB,mBAAmB;CACnB,oCAAoC;CACpC,sEAAsE;AACvE;;AAEA;CACC,UAAU;CACV,WAAW;CACX,gCAAgC;CAChC,uBAAuB;CACvB,mBAAmB;AACpB;;AAEA;CACC,cAAc;AACf;;AAEA;CACC,aAAa;AACd;;AAEA;CACC,gCAAgC;AACjC;;AAEA;EACE,aAAa;EACb,cAAc;AAChB;;AAEA;CACC,UAAU;CACV,YAAY;CACZ,aAAa;AACd;;AAEA;CACC,uBAAuB;CACvB,mBAAmB;CACnB,YAAY;CACZ,UAAU;CACV,gCAAgC;CAChC,eAAe;AAChB;;AAEA;EACE,kBAAkB;EAClB,QAAQ;EACR,SAAS;EACT,kBAAkB;AACpB;;AAEA;EACE,uBAAuB,EAAE,yBAAyB;AACpD;AACA;EACE,sBAAsB,EAAE,wBAAwB;AAClD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,sBAAsB,EAAE,wBAAwB;AAClD;AACA;EACE,uBAAuB,EAAE,yBAAyB;AACpD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,uBAAuB,EAAE,yBAAyB;AACpD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,uBAAuB,EAAE,yBAAyB;AACpD;AACA;EACE,sBAAsB,EAAE,wBAAwB;AAClD;AACA;EACE,uBAAuB,EAAE,yBAAyB;AACpD;AACA;EACE,oBAAoB,EAAE,sBAAsB;AAC9C;AACA;EACE,qBAAqB,EAAE,uBAAuB;AAChD;;AAEA;EACE,aAAa,EAAE,eAAe;AAChC;;AAEA;EACE,aAAa,EAAE,eAAe;AAChC;;;;AAIA;EACE,IAAI,yBAAyB,CAAC;AAChC;;AAEA;EACE,WAAW;EACX,sBAAsB;EACtB,kBAAkB;EAClB,QAAQ;EACR,SAAS;EACT,YAAY;EACZ,aAAa;EACb,iBAAiB;EACjB,kBAAkB;EAClB,kBAAkB;EAClB,sBAAsB;EACtB,yBAAyB;EACzB,wCAAwC;AAC1C;;AAEA;EACE,WAAW;EACX,sBAAsB;EACtB,kBAAkB;EAClB,QAAQ;EACR,SAAS;EACT,YAAY;EACZ,aAAa;EACb,iBAAiB;EACjB,kBAAkB;EAClB,kBAAkB;EAClB,sBAAsB;EACtB,yBAAyB;EACzB,wCAAwC;AAC1C","sourcesContent":[".body_cripav{\n\twidth:100%; height:100%;\n\tpadding: 10px;\n\tfont-family: Verdana, sans-serif;\n\tcolor:#40403f;\n\tbackground-color: #EDF2F8;\n}\n\n.navbar_cripav{\n\twidth:100%;\n\theight: 60px;\n\tdisplay: flex;\n\tjustify-content: center;\n  align-items: center;\n}\n\n.navbar_elem{\n  width:35%;\n  text-align: center;\n}\n\n.horizontal_bar{\n\twidth:3%;\n\theight: 25%;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.btn_navbar{\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-family: Verdana, sans-serif;\n\tcursor:pointer;\n\tborder-radius: 10px;\n\tbackground-color: #f1f1f1;\n\tbox-shadow: 0 2px 5px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12);\n\tmargin-bottom: 5px;\n}\n\n\n.btn_navbar:hover {\n \tbackground-color: #e2e2e2;\n\n}\n\n.btn_navbar:active {\n \tbackground-color:  #d3d4d4;\n}\n\n.btn_run{\n\tbackground-color: white;\n\tbox-shadow: 0 2px 5px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12);\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-family: Verdana, sans-serif;\n\tcursor:pointer;\n\tborder-radius: 10spx;\n\tborder:1px solid black;\n\tmargin:10px;\n}\n\n\n.btn_run:hover {\n \tbackground-color: #E1E4E8;\n}\n\n.btn_run:active {\n \tbackground-color:  #C7C9CE;\n}\n\n\n.row{\n\twidth:100%;\n\theight: 325px;\n\tdisplay: flex;\n\tmargin-top: 5px;\n\tmargin-bottom: 5px;\n}\n\n.content{\n\twidth:100%;\n\theight:100%;\n\tmargin-left:7px;\n\tmargin-right:7px;\n\tborder-radius: 15px;\n\tbackground-color: #f1f1f1 !important;\n\tbox-shadow: 0 2px 5px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12);\n}\n\n.column{\n\twidth:100%;\n\theight:100%;\n\tfont-family: Verdana, sans-serif;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.element_visible{\n\tdisplay: block;\n}\n\n.element_hidden{\n\tdisplay: none;\n}\n\n.line-label{\n\tfont-family: Verdana, sans-serif;\n}\n\n.line-label:hover {\n  color:#40403f;\n  cursor:pointer;\n}\n\n.footer_cripav{\n\twidth:100%;\n\theight: 100%;\n\tdisplay: flex;\n}\n\n.footer_info {\n\tjustify-content: center;\n\talign-items: center;\n\tdisplay:flex;\n\twidth:100%;\n\tfont-family: Verdana, sans-serif;\n\tfont-size: 13px;\n}\n\n.centered {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  text-align: center;\n}\n\n.class0 {\n  fill: rgb(242, 142, 44); stroke: rgb(242, 142, 44);\n}\n.class1 {\n  fill: rgb(225, 87, 89); stroke: rgb(225, 87, 89);\n}\n.class2 {\n  fill: rgb(118, 183, 178); stroke: rgb(118, 183, 178);\n}\n.class3 {\n  fill: rgb(89, 161, 79); stroke: rgb(89, 161, 79);\n}\n.class4 {\n  fill: rgb(237, 201, 73); stroke: rgb(237, 201, 73);\n}\n.class5 {\n  fill: rgb(175, 122, 161); stroke: rgb(175, 122, 161);\n}\n.class6 {\n  fill: rgb(255, 157, 167); stroke: rgb(255, 157, 167);\n}\n.class7 {\n  fill: rgb(156, 117, 95); stroke: rgb(156, 117, 95);\n}\n.class8 {\n  fill: rgb(186, 176, 171); stroke: rgb(186, 176, 171);\n}\n.class9 {\n  fill: rgb(127, 201, 127); stroke: rgb(127, 201, 127);\n}\n.class10 {\n  fill: rgb(190, 174, 212); stroke: rgb(190, 174, 212);\n}\n.class11 {\n  fill: rgb(253, 192, 134); stroke: rgb(253, 192, 134);\n}\n.class12 {\n  fill: rgb(255, 255, 153); stroke: rgb(255, 255, 153);\n}\n.class13 {\n  fill: rgb(245, 34, 206); stroke: rgb(245, 34, 206);\n}\n.class14 {\n  fill: rgb(145,182,255); stroke: rgb(145,182,255);\n}\n.class15 {\n  fill: rgb(67, 247, 244); stroke: rgb(67, 247, 244);\n}\n.class16 {\n  fill: rgb(15, 82, 2); stroke: rgb(15, 82, 2);\n}\n.class-1 {\n  fill: rgb(84, 75, 66); stroke: rgb(84, 75, 66);\n}\n\n.class-non-hotspot {\n  fill: #219fff; stroke: #219fff;\n}\n\n.class-hotspot {\n  fill: #ff2921; stroke: #ff2921;\n}\n\n\n\n@keyframes spinnert {\n  to {transform: rotate(360deg);}\n}\n \n.spinner1{\n  content: '';\n  box-sizing: border-box;\n  position: absolute;\n  top: 17%;\n  left: 75%;\n  width: 100px;\n  height: 100px;\n  margin-top: -10px;\n  margin-left: -10px;\n  border-radius: 50%;\n  border: 5px solid #ccc;\n  border-top-color: #b0ccff;\n  animation: spinnert 0.8s linear infinite;\n}\n\n.spinner2{\n  content: '';\n  box-sizing: border-box;\n  position: absolute;\n  top: 75%;\n  left: 50%;\n  width: 100px;\n  height: 100px;\n  margin-top: -10px;\n  margin-left: -10px;\n  border-radius: 50%;\n  border: 5px solid #ccc;\n  border-top-color: #b0ccff;\n  animation: spinnert 0.8s linear infinite;\n}"],"sourceRoot":""}]);
// Exports
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);


/***/ }),

/***/ "./node_modules/css-loader/dist/cjs.js!./lib/cripav4.css":
/*!***************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js!./lib/cripav4.css ***!
  \***************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../node_modules/css-loader/dist/runtime/api.js */ "./node_modules/css-loader/dist/runtime/api.js");
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__);
// Imports

var ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default()(true);
// Module
___CSS_LOADER_EXPORT___.push([module.id, ".body_cripav{\n\twidth:100%; height:100%;\n\tpadding: 10px;\n\tfont-family: Verdana, sans-serif;\n\tcolor:#40403f;\n\tbackground-color: #EDF2F8;\n}\n\n.navbar_cripav{\n\twidth:100%;\n\theight: 60px;\n\tdisplay: flex;\n\tjustify-content: center;\n  align-items: center;\n}\n\n.navbar_elem{\n  width:35%;\n  text-align: center;\n}\n\n.horizontal_bar{\n\twidth:3%;\n\theight: 25%;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.btn_navbar{\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-family: Verdana, sans-serif;\n\tcursor:pointer;\n\tborder-radius: 10px;\n\tbackground-color: #f1f1f1;\n\tbox-shadow: 0 2px 5px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12);\n\tmargin-bottom: 5px;\n}\n\n\n.btn_navbar:hover {\n \tbackground-color: #e2e2e2;\n\n}\n\n.btn_navbar:active {\n \tbackground-color:  #d3d4d4;\n}\n\n.btn_run{\n\tbackground-color: white;\n\tbox-shadow: 0 2px 5px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12);\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-family: Verdana, sans-serif;\n\tcursor:pointer;\n\tborder-radius: 10spx;\n\tborder:1px solid black;\n\tmargin:10px;\n}\n\n\n.btn_run:hover {\n \tbackground-color: #E1E4E8;\n}\n\n.btn_run:active {\n \tbackground-color:  #C7C9CE;\n}\n\n\n.row{\n\twidth:100%;\n\theight: 300px;\n\tdisplay: flex;\n\tmargin-top: 5px;\n\tmargin-bottom: 5px;\n}\n\n.content{\n\twidth:100%;\n\theight:100%;\n\tmargin-left:7px;\n\tmargin-right:7px;\n\tborder-radius: 15px;\n\tbackground-color: #f1f1f1 !important;\n\tbox-shadow: 0 2px 5px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12);\n}\n\n.column{\n\twidth:100%;\n\theight:100%;\n\tfont-family: Verdana, sans-serif;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.element_visible{\n\tdisplay: block;\n}\n\n.element_hidden{\n\tdisplay: none;\n}\n\n.line-label{\n\tfont-family: Verdana, sans-serif;\n}\n\n.line-label:hover {\n  color:#40403f;\n  cursor:pointer;\n}\n\n.footer_cripav{\n\twidth:100%;\n\theight: 100%;\n\tdisplay: flex;\n}\n\n.footer_info {\n\tjustify-content: center;\n\talign-items: center;\n\tdisplay:flex;\n\twidth:100%;\n\tfont-family: Verdana, sans-serif;\n\tfont-size: 13px;\n}\n\n.centered {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  text-align: center;\n}\n\n.class0 {\n  fill: rgb(242, 142, 44); stroke: rgb(242, 142, 44);\n}\n.class1 {\n  fill: rgb(225, 87, 89); stroke: rgb(225, 87, 89);\n}\n.class2 {\n  fill: rgb(118, 183, 178); stroke: rgb(118, 183, 178);\n}\n.class3 {\n  fill: rgb(89, 161, 79); stroke: rgb(89, 161, 79);\n}\n.class4 {\n  fill: rgb(237, 201, 73); stroke: rgb(237, 201, 73);\n}\n.class5 {\n  fill: rgb(175, 122, 161); stroke: rgb(175, 122, 161);\n}\n.class6 {\n  fill: rgb(255, 157, 167); stroke: rgb(255, 157, 167);\n}\n.class7 {\n  fill: rgb(156, 117, 95); stroke: rgb(156, 117, 95);\n}\n.class8 {\n  fill: rgb(186, 176, 171); stroke: rgb(186, 176, 171);\n}\n.class9 {\n  fill: rgb(127, 201, 127); stroke: rgb(127, 201, 127);\n}\n.class10 {\n  fill: rgb(190, 174, 212); stroke: rgb(190, 174, 212);\n}\n.class11 {\n  fill: rgb(253, 192, 134); stroke: rgb(253, 192, 134);\n}\n.class12 {\n  fill: rgb(255, 255, 153); stroke: rgb(255, 255, 153);\n}\n.class13 {\n  fill: rgb(245, 34, 206); stroke: rgb(245, 34, 206);\n}\n.class14 {\n  fill: rgb(145,182,255); stroke: rgb(145,182,255);\n}\n.class15 {\n  fill: rgb(67, 247, 244); stroke: rgb(67, 247, 244);\n}\n.class16 {\n  fill: rgb(15, 82, 2); stroke: rgb(15, 82, 2);\n}\n.class-1 {\n  fill: rgb(84, 75, 66); stroke: rgb(84, 75, 66);\n}\n\n.class-non-hotspot {\n  fill: #219fff; stroke: #219fff;\n}\n\n.class-hotspot {\n  fill: #ff2921; stroke: #ff2921;\n}\n\n\n\n@keyframes spinnert {\n  to {transform: rotate(360deg);}\n}\n \n.spinner1{\n  content: '';\n  box-sizing: border-box;\n  position: absolute;\n  top: 17%;\n  left: 75%;\n  width: 100px;\n  height: 100px;\n  margin-top: -10px;\n  margin-left: -10px;\n  border-radius: 50%;\n  border: 5px solid #ccc;\n  border-top-color: #b0ccff;\n  animation: spinnert 0.8s linear infinite;\n}\n\n.spinner2{\n  content: '';\n  box-sizing: border-box;\n  position: absolute;\n  top: 75%;\n  left: 50%;\n  width: 100px;\n  height: 100px;\n  margin-top: -10px;\n  margin-left: -10px;\n  border-radius: 50%;\n  border: 5px solid #ccc;\n  border-top-color: #b0ccff;\n  animation: spinnert 0.8s linear infinite;\n}", "",{"version":3,"sources":["webpack://lib/cripav4.css"],"names":[],"mappings":"AAAA;CACC,UAAU,EAAE,WAAW;CACvB,aAAa;CACb,gCAAgC;CAChC,aAAa;CACb,yBAAyB;AAC1B;;AAEA;CACC,UAAU;CACV,YAAY;CACZ,aAAa;CACb,uBAAuB;EACtB,mBAAmB;AACrB;;AAEA;EACE,SAAS;EACT,kBAAkB;AACpB;;AAEA;CACC,QAAQ;CACR,WAAW;CACX,aAAa;CACb,sBAAsB;AACvB;;AAEA;CACC,WAAW;CACX,YAAY;CACZ,aAAa;CACb,uBAAuB;CACvB,mBAAmB;CACnB,gCAAgC;CAChC,cAAc;CACd,mBAAmB;CACnB,yBAAyB;CACzB,sEAAsE;CACtE,kBAAkB;AACnB;;;AAGA;EACE,yBAAyB;;AAE3B;;AAEA;EACE,0BAA0B;AAC5B;;AAEA;CACC,uBAAuB;CACvB,sEAAsE;CACtE,WAAW;CACX,YAAY;CACZ,aAAa;CACb,uBAAuB;CACvB,mBAAmB;CACnB,gCAAgC;CAChC,cAAc;CACd,oBAAoB;CACpB,sBAAsB;CACtB,WAAW;AACZ;;;AAGA;EACE,yBAAyB;AAC3B;;AAEA;EACE,0BAA0B;AAC5B;;;AAGA;CACC,UAAU;CACV,aAAa;CACb,aAAa;CACb,eAAe;CACf,kBAAkB;AACnB;;AAEA;CACC,UAAU;CACV,WAAW;CACX,eAAe;CACf,gBAAgB;CAChB,mBAAmB;CACnB,oCAAoC;CACpC,sEAAsE;AACvE;;AAEA;CACC,UAAU;CACV,WAAW;CACX,gCAAgC;CAChC,uBAAuB;CACvB,mBAAmB;AACpB;;AAEA;CACC,cAAc;AACf;;AAEA;CACC,aAAa;AACd;;AAEA;CACC,gCAAgC;AACjC;;AAEA;EACE,aAAa;EACb,cAAc;AAChB;;AAEA;CACC,UAAU;CACV,YAAY;CACZ,aAAa;AACd;;AAEA;CACC,uBAAuB;CACvB,mBAAmB;CACnB,YAAY;CACZ,UAAU;CACV,gCAAgC;CAChC,eAAe;AAChB;;AAEA;EACE,kBAAkB;EAClB,QAAQ;EACR,SAAS;EACT,kBAAkB;AACpB;;AAEA;EACE,uBAAuB,EAAE,yBAAyB;AACpD;AACA;EACE,sBAAsB,EAAE,wBAAwB;AAClD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,sBAAsB,EAAE,wBAAwB;AAClD;AACA;EACE,uBAAuB,EAAE,yBAAyB;AACpD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,uBAAuB,EAAE,yBAAyB;AACpD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,wBAAwB,EAAE,0BAA0B;AACtD;AACA;EACE,uBAAuB,EAAE,yBAAyB;AACpD;AACA;EACE,sBAAsB,EAAE,wBAAwB;AAClD;AACA;EACE,uBAAuB,EAAE,yBAAyB;AACpD;AACA;EACE,oBAAoB,EAAE,sBAAsB;AAC9C;AACA;EACE,qBAAqB,EAAE,uBAAuB;AAChD;;AAEA;EACE,aAAa,EAAE,eAAe;AAChC;;AAEA;EACE,aAAa,EAAE,eAAe;AAChC;;;;AAIA;EACE,IAAI,yBAAyB,CAAC;AAChC;;AAEA;EACE,WAAW;EACX,sBAAsB;EACtB,kBAAkB;EAClB,QAAQ;EACR,SAAS;EACT,YAAY;EACZ,aAAa;EACb,iBAAiB;EACjB,kBAAkB;EAClB,kBAAkB;EAClB,sBAAsB;EACtB,yBAAyB;EACzB,wCAAwC;AAC1C;;AAEA;EACE,WAAW;EACX,sBAAsB;EACtB,kBAAkB;EAClB,QAAQ;EACR,SAAS;EACT,YAAY;EACZ,aAAa;EACb,iBAAiB;EACjB,kBAAkB;EAClB,kBAAkB;EAClB,sBAAsB;EACtB,yBAAyB;EACzB,wCAAwC;AAC1C","sourcesContent":[".body_cripav{\n\twidth:100%; height:100%;\n\tpadding: 10px;\n\tfont-family: Verdana, sans-serif;\n\tcolor:#40403f;\n\tbackground-color: #EDF2F8;\n}\n\n.navbar_cripav{\n\twidth:100%;\n\theight: 60px;\n\tdisplay: flex;\n\tjustify-content: center;\n  align-items: center;\n}\n\n.navbar_elem{\n  width:35%;\n  text-align: center;\n}\n\n.horizontal_bar{\n\twidth:3%;\n\theight: 25%;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.btn_navbar{\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-family: Verdana, sans-serif;\n\tcursor:pointer;\n\tborder-radius: 10px;\n\tbackground-color: #f1f1f1;\n\tbox-shadow: 0 2px 5px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12);\n\tmargin-bottom: 5px;\n}\n\n\n.btn_navbar:hover {\n \tbackground-color: #e2e2e2;\n\n}\n\n.btn_navbar:active {\n \tbackground-color:  #d3d4d4;\n}\n\n.btn_run{\n\tbackground-color: white;\n\tbox-shadow: 0 2px 5px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12);\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-family: Verdana, sans-serif;\n\tcursor:pointer;\n\tborder-radius: 10spx;\n\tborder:1px solid black;\n\tmargin:10px;\n}\n\n\n.btn_run:hover {\n \tbackground-color: #E1E4E8;\n}\n\n.btn_run:active {\n \tbackground-color:  #C7C9CE;\n}\n\n\n.row{\n\twidth:100%;\n\theight: 300px;\n\tdisplay: flex;\n\tmargin-top: 5px;\n\tmargin-bottom: 5px;\n}\n\n.content{\n\twidth:100%;\n\theight:100%;\n\tmargin-left:7px;\n\tmargin-right:7px;\n\tborder-radius: 15px;\n\tbackground-color: #f1f1f1 !important;\n\tbox-shadow: 0 2px 5px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12);\n}\n\n.column{\n\twidth:100%;\n\theight:100%;\n\tfont-family: Verdana, sans-serif;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.element_visible{\n\tdisplay: block;\n}\n\n.element_hidden{\n\tdisplay: none;\n}\n\n.line-label{\n\tfont-family: Verdana, sans-serif;\n}\n\n.line-label:hover {\n  color:#40403f;\n  cursor:pointer;\n}\n\n.footer_cripav{\n\twidth:100%;\n\theight: 100%;\n\tdisplay: flex;\n}\n\n.footer_info {\n\tjustify-content: center;\n\talign-items: center;\n\tdisplay:flex;\n\twidth:100%;\n\tfont-family: Verdana, sans-serif;\n\tfont-size: 13px;\n}\n\n.centered {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  text-align: center;\n}\n\n.class0 {\n  fill: rgb(242, 142, 44); stroke: rgb(242, 142, 44);\n}\n.class1 {\n  fill: rgb(225, 87, 89); stroke: rgb(225, 87, 89);\n}\n.class2 {\n  fill: rgb(118, 183, 178); stroke: rgb(118, 183, 178);\n}\n.class3 {\n  fill: rgb(89, 161, 79); stroke: rgb(89, 161, 79);\n}\n.class4 {\n  fill: rgb(237, 201, 73); stroke: rgb(237, 201, 73);\n}\n.class5 {\n  fill: rgb(175, 122, 161); stroke: rgb(175, 122, 161);\n}\n.class6 {\n  fill: rgb(255, 157, 167); stroke: rgb(255, 157, 167);\n}\n.class7 {\n  fill: rgb(156, 117, 95); stroke: rgb(156, 117, 95);\n}\n.class8 {\n  fill: rgb(186, 176, 171); stroke: rgb(186, 176, 171);\n}\n.class9 {\n  fill: rgb(127, 201, 127); stroke: rgb(127, 201, 127);\n}\n.class10 {\n  fill: rgb(190, 174, 212); stroke: rgb(190, 174, 212);\n}\n.class11 {\n  fill: rgb(253, 192, 134); stroke: rgb(253, 192, 134);\n}\n.class12 {\n  fill: rgb(255, 255, 153); stroke: rgb(255, 255, 153);\n}\n.class13 {\n  fill: rgb(245, 34, 206); stroke: rgb(245, 34, 206);\n}\n.class14 {\n  fill: rgb(145,182,255); stroke: rgb(145,182,255);\n}\n.class15 {\n  fill: rgb(67, 247, 244); stroke: rgb(67, 247, 244);\n}\n.class16 {\n  fill: rgb(15, 82, 2); stroke: rgb(15, 82, 2);\n}\n.class-1 {\n  fill: rgb(84, 75, 66); stroke: rgb(84, 75, 66);\n}\n\n.class-non-hotspot {\n  fill: #219fff; stroke: #219fff;\n}\n\n.class-hotspot {\n  fill: #ff2921; stroke: #ff2921;\n}\n\n\n\n@keyframes spinnert {\n  to {transform: rotate(360deg);}\n}\n \n.spinner1{\n  content: '';\n  box-sizing: border-box;\n  position: absolute;\n  top: 17%;\n  left: 75%;\n  width: 100px;\n  height: 100px;\n  margin-top: -10px;\n  margin-left: -10px;\n  border-radius: 50%;\n  border: 5px solid #ccc;\n  border-top-color: #b0ccff;\n  animation: spinnert 0.8s linear infinite;\n}\n\n.spinner2{\n  content: '';\n  box-sizing: border-box;\n  position: absolute;\n  top: 75%;\n  left: 50%;\n  width: 100px;\n  height: 100px;\n  margin-top: -10px;\n  margin-left: -10px;\n  border-radius: 50%;\n  border: 5px solid #ccc;\n  border-top-color: #b0ccff;\n  animation: spinnert 0.8s linear infinite;\n}"],"sourceRoot":""}]);
// Exports
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);


/***/ }),

/***/ "./node_modules/css-loader/dist/cjs.js!./lib/scatterplot.css":
/*!*******************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js!./lib/scatterplot.css ***!
  \*******************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../node_modules/css-loader/dist/runtime/api.js */ "./node_modules/css-loader/dist/runtime/api.js");
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__);
// Imports

var ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default()(true);
// Module
___CSS_LOADER_EXPORT___.push([module.id, ".dot {\n  fill: #69b3a2;\n}", "",{"version":3,"sources":["webpack://lib/scatterplot.css"],"names":[],"mappings":"AAAA;EACE,aAAa;AACf","sourcesContent":[".dot {\n  fill: #69b3a2;\n}"],"sourceRoot":""}]);
// Exports
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);


/***/ }),

/***/ "./lib/comparison_map.js":
/*!*******************************!*\
  !*** ./lib/comparison_map.js ***!
  \*******************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

__webpack_require__(/*! ./comparison_map.css */ "./lib/comparison_map.css"); // styles
var d3 = __webpack_require__(/*! d3 */ "webpack/sharing/consume/default/d3/d3");
var d3_lasso = __webpack_require__(/*! d3-lasso */ "webpack/sharing/consume/default/d3-lasso/d3-lasso");
var d3_tip = __webpack_require__(/*! ./d3-tip.js */ "./lib/d3-tip.js");
var deckgl_core = __webpack_require__(/*! @deck.gl/core */ "webpack/sharing/consume/default/@deck.gl/core/@deck.gl/core?d123");
var deckgl_layers = __webpack_require__(/*! @deck.gl/layers */ "webpack/sharing/consume/default/@deck.gl/layers/@deck.gl/layers");
var deckgl_mapbox = __webpack_require__(/*! @deck.gl/mapbox */ "webpack/sharing/consume/default/@deck.gl/mapbox/@deck.gl/mapbox");
var mapbox_gl = __webpack_require__(/*! mapbox-gl */ "webpack/sharing/consume/default/mapbox-gl/mapbox-gl");

window.d3=d3;
window.d3_lasso = d3_lasso;
window.d3_tip = d3_tip;
window.deckgl_core=deckgl_core;
window.deckgl_layers=deckgl_layers;
window.deckgl_mapbox = deckgl_mapbox;
window.mapbox_gl = mapbox_gl;

// misc functions

function create_name(name, dv_name){
    return name +"_" + dv_name
}

function return_name(name){
    return name.slice(0, -6); // remove last 5 characters that are id of class
}

function parse_rgb_attr(input){
    input = input.slice(4, -1);
    var array = JSON.parse("[" + input + "]");
    return array;
}

function monthDiff(d1, d2) {
    var months;
    months = (d2.getFullYear() - d1.getFullYear()) * 12;
    months -= d1.getMonth();
    months += d2.getMonth();
    return months <= 0 ? 0 : months;
}


// global vars data
let div_name;
let ValueScales;
var map;
let deckOverlays = [];

var alert_cid = function(that, cid){
    /*add_loading_div2(that);
    that.model.set({'clicked_dot': cid});
    that.touch();*/
    alert(cid);
};

var create = function (that) {
    console.log('start create');
    // intialize the html
    that.el.setAttribute('class', 'd3-cripav3');
    var div_name = that.model.get('_div_name');
    var datasets = that.model.get('datasets');
    var html_text = `
        <div id="`+create_name('body',div_name)+`" class="body_comparison_map">        
    `;
    for (let i = 0; i < datasets.length; i++){
        html_text += `<div class="row">
            <div id="`+create_name('map_'+i,div_name)+`" class="content element_visible" style="width:100%;"> 
                </div>
            </div>
        `;
    }
    
    deckOverlays = [];
    html_text +=`</div>`
    that.el.innerHTML = html_text;
    window.dom = that.el;


    setTimeout(function(){ // we have to wait until the html is created; TODO: find other solution
        // add base map to container
        for (let i = 0; i < datasets.length; i++){
            map = new mapbox_gl.Map({
                container: create_name('map_'+i,div_name),
                style: 'mapbox://styles/mapbox/light-v9',
                accessToken: 'pk.eyJ1IjoiZ2VnYXphIiwiYSI6ImNqOHNkMXV0cDA4bGgzM3A4OHZwOHNxYWUifQ.cEY6vV7UqVGv7Qd3WxI-dA',
                center: [-46.634731, -23.548682],
                zoom: 12,
                antialias: true,
                bearing: 30,
                pitch: 0,
                attributionControl: false
            });
            var deckOverlay = new deckgl_mapbox.MapboxOverlay({
                interleaved:true,
                layers: []
            });
            map.addControl(deckOverlay);
            deckOverlays.push(deckOverlay);
            render_map(that, i);
        }
    }, 300);
}

var render = function(that) {
    console.log('start render');
}

var render_map = function (that, i) {
    console.log('START RENDER MAP');
    var dataset = that.model.get('datasets')[i];
    var current_scale = d3.scaleLinear()
                    .domain(d3.extent(dataset.map(d => d.value))).nice()
                    .range([ 0, 35 ]);
    console.log(dataset);
    var data_layer = new deckgl_layers.ColumnLayer({
                    data: dataset,
                    diskResolution: 12,
                    radius:that.model.get('radius'),
                    extruded: true,
                    pickable: true,
                    elevationScale: 70,
                    getPosition: d => [d.lng,d.lat],
                    // getFillColor: d=> [],
                    getFillColor: d=> [66, 135, 245],
                    getLineColor: [0, 0, 0],
                    getElevation:d=> current_scale(d.value),
                });
    
    deckOverlays[i].setProps({
        layers: [data_layer],
        onClick: ({object}) => alert_cid(that, object.cid),
        getTooltip: ({object}) => object && {
            html: `<h5>${object.value}</h5>`,
            style: {
                backgroundColor: '#e8f8ff'
            }
        }
    })                
}


var view = {
    create: create,
    render_map:render_map
};

module.exports = view;

/***/ }),

/***/ "./lib/cripav4.js":
/*!************************!*\
  !*** ./lib/cripav4.js ***!
  \************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

__webpack_require__(/*! ./cripav4.css */ "./lib/cripav4.css"); // styles
var d3 = __webpack_require__(/*! d3 */ "webpack/sharing/consume/default/d3/d3");
var d3_lasso = __webpack_require__(/*! d3-lasso */ "webpack/sharing/consume/default/d3-lasso/d3-lasso");
var d3_tip = __webpack_require__(/*! ./d3-tip.js */ "./lib/d3-tip.js");
var deckgl_core = __webpack_require__(/*! @deck.gl/core */ "webpack/sharing/consume/default/@deck.gl/core/@deck.gl/core?d123");
var deckgl_layers = __webpack_require__(/*! @deck.gl/layers */ "webpack/sharing/consume/default/@deck.gl/layers/@deck.gl/layers");
var deckgl_mapbox = __webpack_require__(/*! @deck.gl/mapbox */ "webpack/sharing/consume/default/@deck.gl/mapbox/@deck.gl/mapbox");
var mapbox_gl = __webpack_require__(/*! mapbox-gl */ "webpack/sharing/consume/default/mapbox-gl/mapbox-gl");

window.d3=d3;
window.d3_lasso = d3_lasso;
window.d3_tip = d3_tip;
window.deckgl_core=deckgl_core;
window.deckgl_layers=deckgl_layers;
window.deckgl_mapbox = deckgl_mapbox;
window.mapbox_gl = mapbox_gl;

// misc functions

function create_name(name, dv_name){
    return name +"_" + dv_name
}

function return_name(name){
    return name.slice(0, -6); // remove last 5 characters that are id of class
}

function parse_rgb_attr(input){
    input = input.slice(4, -1);
    var array = JSON.parse("[" + input + "]");
    return array;
}

function monthDiff(d1, d2) {
    var months;
    months = (d2.getFullYear() - d1.getFullYear()) * 12;
    months -= d1.getMonth();
    months += d2.getMonth();
    return months <= 0 ? 0 : months;
}

var alert_cid = function(that, cid){
    add_loading_div2(that);
    that.model.set({'clicked_dot': cid});
    that.touch();
};


// global vars data
var div_name;
var CrimeScale;
var map;
var deckOverlay;


var create = function (that) {
    console.log('start create');

    // intialize the html
    that.el.setAttribute('class', 'd3-cripav3');
    div_name = that.model.get('_div_name');
    that.el.innerHTML = `
        <div id="`+create_name('body',div_name)+`" class="body_cripav">        
            <div id="title" class="row content" style="height:50px;width:99%">
                <div style="height:100%;width:40%;">
                    <h3 style="text-align: center;">CriPAV</h3>
                </div>
                <div id="`+create_name('footer_cripav',div_name)+`" class="footer_cripav">
                    <div id ="all_nodes" class="footer_info">Crimes:    | Nodes:</div>
                    <div class="footer_info" style="width:50%"><b>Selected: </b></div>
                    <div id ="selected_nodes" class="footer_info">Crimes:    | Nodes:</div>
                </div>
            </div>

            <div class="row">
                <div id="`+create_name('map',div_name)+`" class="content element_visible" style="width:50%;"> 
                </div>
                <div id="`+create_name('scatter',div_name)+`" class="content element_visible" style="width:50%;">
                    <div id="`+create_name('controls_cripav',div_name)+`" class="navbar_cripav" style="height:10%;">
                        <div class="navbar_elem">Alpha:</div>
                        <input type="number" id="alpha_mf" name="alpha_mf" style="width:30%;" min="0" max="1" step="0.1" value="0.5">
                        <div class="navbar_elem">Pct:</div>
                        <input type="number" id="pct_mf" name="pct_mf" style="width:30%;" min="0" max="100" step="1" value="3">
                        <div id="`+create_name('btn_run', div_name)+`" class="btn_run"><b>RUN</b></div>
                    </div>
                    <div id="`+create_name('loading_div1',div_name)+`"></div>
                </div>
            </div>
            <div class="row">
                        <div class="horizontal_bar">
                            <div id="`+create_name('btn_clusters', div_name)+`" class="btn_navbar group1" data-value="clusters">
                            <svg xmlns="http://www.w3.org/2000/svg" height="40" viewBox="0 -960 960 960" width="40">
                            <path d="M674.776-169.23q-48.481 0-82.603-33.757-34.122-33.756-34.122-82.237 0-48.481 34.122-82.603 34.122-34.122 82.603-34.122 48.481 0 82.237 34.122 33.757 34.122 33.757 82.603 0 48.481-33.757 82.237-33.756 33.757-82.237 33.757Zm-.366-33.847q34.539 0 58.526-23.987 23.987-23.987 23.987-58.526 0-34.538-23.987-58.525-23.987-23.987-58.526-23.987-34.538 0-58.525 23.987-23.987 23.987-23.987 58.525 0 34.539 23.987 58.526 23.987 23.987 58.525 23.987Zm-389.186-89.23q-48.481 0-82.237-33.757-33.757-33.756-33.757-82.237 0-48.481 33.757-82.603 33.756-34.122 82.237-34.122 48.481 0 82.603 34.122 34.122 34.122 34.122 82.603 0 48.481-34.122 82.237-34.122 33.757-82.603 33.757Zm.282-33.847q34.468 0 58.532-23.98 24.064-23.98 24.064-58.449 0-34.468-24.064-58.532-24.064-24.065-58.532-24.065-34.469 0-58.449 24.065-23.98 24.064-23.98 58.532 0 34.469 23.98 58.449 23.98 23.98 58.449 23.98Zm153.411-265.744q-48.481 0-82.238-34.121-33.756-34.122-33.756-82.603 0-48.481 33.756-82.237 33.757-33.757 82.238-33.757 48.48 0 82.602 33.757 34.122 33.756 34.122 82.237 0 48.481-34.122 82.603-34.122 34.121-82.602 34.121Zm.365-33.846q34.539 0 58.526-23.987 23.987-23.987 23.987-58.526 0-34.538-23.987-58.525-23.987-23.988-58.526-23.988t-58.526 23.988q-23.987 23.987-23.987 58.525 0 34.539 23.987 58.526 23.987 23.987 58.526 23.987Zm235.385 340.411ZM285.333-408.41Zm153.693-300.103Z"/></svg>
                            </div>
                            <div id="`+create_name('btn_group', div_name)+`" class="btn_navbar group1" data-value="group">
                            <svg xmlns="http://www.w3.org/2000/svg" height="40" viewBox="0 -960 960 960" width="40">
                            <path d="M160-160v-201.795h283.077V-160H160Zm356.923 0v-364.872H800V-160H516.923ZM409.231-327.949Zm141.538-163.077ZM160-435.641V-800h283.077v364.359H160Zm249.231-33.846Zm107.692-129.231V-800H800v201.282H516.923Zm33.846-33.846ZM193.846-193.846h215.385v-134.103H193.846v134.103Zm356.923 0h215.385v-297.18H550.769v297.18ZM193.846-469.487h215.385v-296.667H193.846v296.667Zm356.923-163.077h215.385v-133.59H550.769v133.59Z"/></svg>
                            </div>
                        </div>
                        <div id="`+create_name('clusters',div_name)+`" class="content element_visible views1" style="width:47%"></div>
                        <div id="`+create_name('group',div_name)+`" class="content element_hidden views1" style="width:47%"></div>
                <div id="`+create_name('time_series',div_name)+`" class="content element_visible" style="overflow-y: scroll;width:50%;">
                </div>
            </div>

            <div class="row" style="height:230px;">
                <div id="img_container" class="content element_visible">
                    <div id="`+create_name('loading_div2',div_name)+`"></div>
                    <div id="`+create_name('img_date',div_name)+`" style="text-align: center;width:100%;height:10%;">Date</div>
                    <img id="`+create_name('img_viz',div_name)+`" src="" style="width:100%;height:90%;">
                </div>
            </div>

            <div class="row" style="height:100px;">
                <div id="`+create_name('images',div_name)+`" class="content element_visible"></div>
            </div>
        </div>
    `
    window.dom = that.el;
    CrimeScale = d3.scaleLinear()
                    .domain(that.model.get('value_int_range')).nice()
                    .range([ 0, 15 ]);

    setTimeout(function(){ // we have to wait until the html is created; TODO: find other solution
        document.getElementById(create_name('btn_run', div_name)).onclick = function() {
            var n_execution = that.model.get('n_run');
            that.model.set({ 'alpha_mf': parseFloat(document.getElementById("alpha_mf").value)});
            that.model.set({ 'pct_mf': parseFloat(document.getElementById("pct_mf").value)});
            that.model.set({ 'n_run': n_execution + 1});
            add_loading_div1(that);
            that.touch();
        };
        // add base map to container
        map = new mapbox_gl.Map({
            container: create_name('map',div_name),
            style: 'mapbox://styles/mapbox/light-v9',
            accessToken: 'pk.eyJ1IjoiZ2VnYXphIiwiYSI6ImNqOHNkMXV0cDA4bGgzM3A4OHZwOHNxYWUifQ.cEY6vV7UqVGv7Qd3WxI-dA',
            center: [-46.634731, -23.548682],
            zoom: 12,
            antialias: true,
            bearing: 30,
            pitch: 0,
            attributionControl: false
        });
        deckOverlay = new deckgl_mapbox.MapboxOverlay({
            interleaved:true,
            layers: []
        });
        map.addControl(deckOverlay);
        set_links(that);
        render_probint_scatter(that);
    }, 100);
}

var render = function(that) {
    console.log('start render');

    set_links(that);
}

var render_probint_scatter = function(that){
    // remove loading div
    remove_loading_div1(that);
    console.log('RENDER PROBINT SCATTER');
    var name = create_name('scatter',div_name);
    var prev_svg = d3.select('#'+name);
    prev_svg.selectAll('g').remove();
    prev_svg.selectAll('svg').remove();
    var curr_visible = document.getElementById(create_name('scatter',div_name)).id;
    var divWidth  = document.getElementById(curr_visible).clientWidth;
    var divHeight = document.getElementById(curr_visible).clientHeight;
    divHeight = divHeight - 0.10*divHeight;  // take 10% for parameter bar;
    var xScale = d3.scaleLinear()
                .domain(that.model.get('value_prob_range')).nice()
                .range([0, 1]);

    var yScale = d3.scaleLinear()
                .domain(that.model.get('value_int_range')).nice()
                .range([0, 1]);

    var margin_pct = { 
        top: 0.05*divHeight,
        right: 0.10*divWidth,
        bottom: 0.15*divHeight,
        left: 0.12*divWidth
    };

    var width = divWidth  - margin_pct.left - margin_pct.right;
    var height = divHeight - margin_pct.top - margin_pct.bottom;
    console.log('scatter height and width');
    console.log(height+' ; '+ width);


    var svg = d3.select('#'+name)
                .append("svg")
                .attr("width",  divWidth)
                .attr("height", divHeight);

    var x=d3.scaleLinear()
            .domain([0,1])
            .range([ 0, width ]);

    var y=d3.scaleLinear()
            .domain([0,1])
            .range([ height, 0]);

    const g_probint = svg.append("g")
        .attr('id', 'probint_plot')
        .attr("transform","translate(" + margin_pct.left + "," + margin_pct.top + ")")

    const axisx = g_probint.append("g")
            .attr("transform", "translate(0, "+ height + ")")
            .call(d3.axisBottom(x).ticks(8));    

    const axisy = g_probint.append("g")
            .call(d3.axisLeft(y).ticks(8));

    svg.append("text")
        .attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
        .attr("transform", "translate("+margin_pct.left/2+ ","+((height/2)+margin_pct.top)+")rotate(-90)")  // text is drawn off the screen top left, move down and out and rotate
        .style("fill","black")
        .text("Intensity");

    svg.append("text")
        .attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
        .attr("transform", "translate("+((width/2)+margin_pct.left)+","+(divHeight-10)+")")  // text is drawn off the screen top left, move down and out and rotate
        .style("fill","black")
        .text("Probability");

    var no_hs = that.model.get('non_hotspots');
    const dots_probint_no_hotspot = g_probint.append('g')
        .selectAll("circle")
        .data(no_hs)
        .join("circle")
          .attr('class', 'class-non-hotspot')        
          .attr("cx", function (d) { return x(xScale(d.prob)); } )
          .attr("cy", function (d) { return y(yScale(d.inte)); } )
          .attr("r", 3)
          .attr("opacity", 0.3)
          .style("stroke", "black")
            .style("stroke-opacity",0.3)
            .style("stroke-width",1)
          .attr("id",function(d){return d.cid;});

    var data = that.model.get('current_selection');
    if (data.length > 0){
        const dots_probint_hotspot_selected = g_probint.append('g')
            .selectAll("circle")
            .data(data)
            .join("circle")
            .attr('class', function (d) { return 'class'+d.class.toString(); })        
            .attr("cx", function (d) { return x(xScale(d.prob)); } )
            .attr("cy", function (d) { return y(yScale(d.inte)); } )
            .attr("r", 3)
            .style("stroke", "black")
            .style("stroke-opacity",1)
            .style("stroke-width",1)
            .attr("id",function(d){return d.cid;});
    }
    else{
        var data = that.model.get('data_cluster');
        const dots_probint_hotspot = g_probint.append('g')
        .selectAll("circle")
        .data(data)
        .join("circle")
          .attr('class', 'class-hotspot')        
          .attr("cx", function (d) { return x(xScale(d.prob)); } )
          .attr("cy", function (d) { return y(yScale(d.inte)); } )
          .attr("r", 3)
          .attr("opacity", 0.6)
          .style("stroke", "black")
          .style("stroke-opacity",0.6)
          .style("stroke-width",1)
          .attr("id",function(d){return d.cid;});
    }
    
};

var render_cluster_plot = function(that) {
    console.log('START RENDER CLUSTER PLOT');

    var curr_visible = document.getElementsByClassName('content element_visible views1')[0].id;
    var divWidth  = document.getElementById(curr_visible).clientWidth;
    var divHeight = document.getElementById(curr_visible).clientHeight;
    
    var prev_svg = d3.select("#"+create_name('clusters',div_name));
    prev_svg.selectAll('g').remove();
    prev_svg.selectAll('svg').remove();

    var svg = d3.select("#"+create_name('clusters',div_name))
                .append("svg")
                .attr("width",  divWidth)
                .attr("height", divHeight);

    var margin_pct = {
        top: 0.03*divHeight,
        right: 0.03*divWidth,
        bottom: 0.03*divHeight,
        left: 0.03*divWidth
    };

    var width = divWidth  - margin_pct.left - margin_pct.right;
    var height = divHeight - margin_pct.top - margin_pct.bottom;
    
    var data = that.model.get('data_cluster');
    var x=d3.scaleLinear()
            .domain(d3.extent(data, d=>d.x))
            .range([ 0, width ]);

    var y=d3.scaleLinear()
            .domain(d3.extent(data, d=>d.y))
            .range([ height, 0]);

    const g_cluster_plot = svg.append("g")
        .attr('id', 'cluster_plot')
        .attr("transform","translate(" + margin_pct.left + "," + margin_pct.top + ")")


    nodes_filtered = data.filter(node => node.class != -1);
    const dots_clusterplot = g_cluster_plot.append('g')
        .selectAll("circle")
        .data(nodes_filtered)
        .join("circle")
          .attr('class', function (d) { return 'class'+d.class.toString(); })        
          .attr("cx", function (d) { return x(d.x); } )
          .attr("cy", function (d) { return y(d.y); } )
          .attr("r", 3.5)
          .attr("id",function(d){return d.cid;})
          .style('stroke', 'black')
          .style('stroke-width', 0.5);

    var lasso_start = function() {
        // console.log('Lasso start');
        lasso.items()
            .attr("r",3.5); // reset size
            //.classed("not_possible",true)
            //.classed("selected",false);
    };

    var lasso_draw = function() {
                
        // Style the possible dots
        lasso.possibleItems()
            .classed("not_possible",false)
            .classed("possible",true);

            // Style the not possible dot
        lasso.notPossibleItems()
            .classed("not_possible",true)
            .classed("possible",false);
        };

    var lasso_end = function() {
        // console.log('Lasso end');
        // Reset the color of all dots
        //lasso.items()
          //  .classed("not_possible",false)
            //.classed("possible",false);

            // Style the selected dots
        lasso.selectedItems()
            .attr("r",7);
            //.classed("selected",true)

        ids = [];
        lasso.selectedItems()._groups[0].forEach(function(d){ids.push(d.id)});
        that.model.set({ 'selected_ids': ids});
        // console.log(ids);
        that.touch();
        // Reset the style of the not selected dots    
    };

    const lasso = d3_lasso.lasso()
          .closePathDistance(305) 
          .closePathSelect(true) 
          .targetArea(svg)
          .items(dots_clusterplot) 
          .on("start",lasso_start) 
          .on("end",lasso_end); 
          //.on("draw",lasso_draw) 
    svg.call(lasso);
};

var render_map = function (that) {
    console.log('START RENDER MAP');
    var nodes = that.model.get('current_selection');
    if (nodes.length == 0){
        nodes = that.model.get('data_cluster');
    }
    nodes_filtered = nodes.filter(node => node.class != -1);
    for (let i = 0; i < nodes_filtered.length; i++){
        var elemt = document.getElementsByClassName('class'+nodes_filtered[i].class.toString())[0];
        //console.log(elemt);
        var style = window.getComputedStyle(elemt);
        //console.log('estilo');
        var color = style.getPropertyValue('fill');
        nodes_filtered[i].color = parse_rgb_attr(color);
    }
    //console.log(nodes_filtered);
    var data_layer = new deckgl_layers.ColumnLayer({
                    data: nodes_filtered,
                    diskResolution: 12,
                    radius:30,
                    extruded: true,
                    pickable: true,
                    elevationScale: 70,
                    getPosition: d => [d.lng,d.lat],
                    // getFillColor: d=> [],
                    getFillColor: d=> d.color,
                    getLineColor: [0, 0, 0],
                    getElevation:d=> CrimeScale(d.inte),
                });
    
    deckOverlay.setProps({
        layers: [data_layer],
        onClick: ({object}) => alert_cid(that, object.cid),
        getTooltip: ({object}) => object && {
            html: `<h5>${object.cid}</h5>`,
            style: {
                backgroundColor: '#e8f8ff'
            }
        }
    })                
}

var render_group_chart_plot = function(that) {
    console.log('START RENDER GROUP CHART PLOT');
    var curr_visible = document.getElementsByClassName('content element_visible views1')[0].id;
    var dataset = that.model.get('data_cluster_mean');
    var divWidth  = document.getElementById(curr_visible).clientWidth;
    var divHeight = document.getElementById(curr_visible).clientHeight;
    var margin_pct = {
        top: 0.03*divHeight,
        right: 0.01*divWidth,
        bottom: 0.03*divHeight,
        left: 0.03*divWidth
    };
    
    var width = divWidth - margin_pct.left - margin_pct.right;
    var height = divHeight - margin_pct.bottom - margin_pct.top;

    console.log(divHeight, divWidth);
    console.log(height, width);
    console.log(dataset);
    var prev_svg = d3.select("#"+create_name('group',div_name));
    prev_svg.selectAll('g').remove();
    prev_svg.selectAll('svg').remove();

    var Mainsvg = d3.select("#"+create_name('group',div_name))
        .append("svg")
        .attr("width", divWidth)
        .attr("height", divHeight)

    var scatterArrange = Mainsvg.append('g')
        .attr('width', width )
        .attr('height', height)
        .attr('transform', 'translate(' + margin_pct.left + ',' + margin_pct.top + ')');
    
    var x=d3.scaleLinear()
        .domain([0,40])
        .range([ 0, width]);

    var y=d3.scaleLinear()
        .domain([0,20])
        .range([0, height]);
    
   
    
    var Scales = {};
    dataset.forEach(function(d){
        let  landExtent = d3.extent(d.serie.upper, function(f) { return f; });
        let xes = d3.scaleLinear()
                 .domain([0, d.serie.mean.length])
                 .range([x(d.x),x(d.x+d.with)]);

        let yes = d3.scaleLinear()
                .domain([0,landExtent[1]])
                .range([y(d.y)+y(d.height),y(d.y)]);
        
        Scales[d.class]={"xScale":xes,"yScale":yes};
    });
    
    var Areas = {};
    var Lines = {};
    dataset.forEach(function(j){
        Areas[j.class]= d3.area()
            .x(function(d,i) { 
                return Scales[j.class].xScale(i); })
            .y1(function(d){ 
                return Scales[j.class].yScale(d[2]); })
            .y0(function(d){ 
                return Scales[j.class].yScale(d[0]);})
            .curve(d3.curveBasis);
        
        Lines[j.class]= d3.line()
            .x(function(d,i) {          return Scales[j.class].xScale(i); })
            .y(function(d){             return Scales[j.class].yScale(d[1]); })
            .curve(d3.curveBasis);
    });
    
    var ListMixture = {};
    dataset.forEach(function(f){
        let TempArray =[];
        f.serie.mean.forEach(function(d,i){
            TempArray.push([f.serie.lower[i],d,f.serie.upper[i]])
        });
        ListMixture[f.class] = TempArray;
    });

    var area_path = scatterArrange.selectAll(".area")
        .data(dataset)
        .enter().append("path")
        .attr("id",function(d){return "arr_"+d.class;})
        .attr("class", function(d){return "class"+d.class;})
        .attr("d", function(d){ 
            return Areas[d.class](ListMixture[d.class]);
         })
        .attr("fill-opacity",0.7)
        .attr("stroke-opacity", 1);
        //.attr("fill",function(d){return CLASES[d.class].color})
        //.attr("stroke",function(d){return CLASES[d.class].color;})
    
     var Line_path = scatterArrange.selectAll(".area")
        .data(dataset)
        .enter().append("path")
        .attr("d", function(d){ return Lines[d.class](ListMixture[d.class]);   })
        .attr("fill","none")
        .attr("stroke","#4e4e4e")//function(d){return CLASES[d.class].color;})
        .attr("stroke-opacity", 1)
        .attr("stroke-width",2)
    
    scatterArrange.selectAll("rect")
        .data(dataset)
        .enter()
        .append("rect")
            .attr("x",function(d){return x(d.x)})
            .attr("y",function(d){return y(d.y)})
            .attr("width",function(d){return x(d.with)})
            .attr("height",function(d){return y(d.height)})
            .attr("fill-opacity",0)
            .attr("stroke", "#747474")
            .attr("stroke-width",2)
            .on("click",function(e){
                that.model.set({ 'selected_class':e.class});
                // console.log(that.model.get('selected_class'));
                that.touch();
            });
            //.attr("fill",function(d){return CLASES[d.class].color})
};

var render_time_series = function(that) {
    console.log('START RENDER TIME SERIES');
    var prev_svg = d3.select("#"+create_name('time_series',div_name));
    prev_svg.selectAll('g').remove();
    prev_svg.selectAll('svg').remove();

    var data = that.model.get('current_time_series');
    if (data.length == 0){
        return 1;
    }
    /*CALC MAXIMUN*/
    var maximo = 0;
    for (let i = 0; i < data.length; i++){

        var temp_max = d3.max(data[i].data.map(x => x.value));
        if (temp_max > maximo){
            maximo = temp_max;
        }
    }
    // console.log(data);
    ////////////////////////
    var curr_visible = document.getElementById(create_name('time_series',div_name)).id;
    var divWidth  = document.getElementById(curr_visible).clientWidth;
    var divHeight = document.getElementById(curr_visible).clientHeight;

    var total_height = (data.length)*30;

    var svg = d3.select("#"+create_name('time_series',div_name))
                .append("svg")
                .attr("width",  divWidth)
                .attr("height", total_height);

    var margin_pct = {
        top: 0,
        right: 0.05*divWidth,
        bottom: 15,
        left: 0.05*divWidth
    };

    var width = divWidth  - margin_pct.left - margin_pct.right;
    var height = total_height - margin_pct.top - margin_pct.bottom;    

    const g_time_series_plot = svg.append("g")
        .attr('id', 'g_time_series_plot')
        .attr("width",  width)
        .attr("height", total_height)
        .attr("transform","translate(" + margin_pct.left + "," + margin_pct.top + ")");

    let cids = data.map(function(f){return f.id}); 

    let x = d3.scaleLinear()
      .range([0, width])
      .domain([0,data[0].data.length]);

    let y_wrapper = d3.scaleBand()
      .range([0, height])
      .domain(cids);

    let y = d3.scaleLinear()
      .domain([0,maximo])
      .range([y_wrapper.bandwidth(), 0])

    let area = d3.area()
      .x(function(d){ return x(d.month); })
      .y1(function(d) { return y(d.value); })
      .y0(y(0))
      .curve(d3.curveBasis);
    
    g_time_series_plot.append("g")
      .attr("class", "axisWhite")
      .attr("transform", "translate(0, " + (height - 2) + ")")
      .call(d3.axisBottom(x))

    // baselines
    g_time_series_plot.selectAll(".baseline")
        .data(data, function(d){ return d.id; })
      .enter().append("line")
        .attr("class", "baseline")
        .attr("x1", 0)
        .attr("x2", width)
        .attr("y1", function(d) { return y_wrapper(d.id) + y_wrapper.bandwidth(); })
        .attr("y2", function(d) { return y_wrapper(d.id) + y_wrapper.bandwidth(); })
        .attr("stroke","black")
        .attr("stroke-opacity",1)
        .style("fill","#82bcfa");
    // JOIN
    var area_path = g_time_series_plot.selectAll(".areas")
        .data(data, function(d){ return d.id; })
        .enter().append("path")
        .attr("class", "areas")
        .attr("stroke","black")
        .attr("stroke-opacity",1)
        .attr("opacity",1)
        .attr("transform", function(d) { return "translate(0, " + (y_wrapper(d.id) - 1.5) + ")"; })
        .attr("d", function(d){ return area(d.data); })
        .style("fill","#82bcfa");
    
    // labels
    g_time_series_plot.selectAll(".line-label")
        .data(data, function(d){ return d.id; })
      .enter().append("text")
        .attr("class", "line-label")
        .attr("x", -30)
        .attr("y", function(d) { return y_wrapper(d.id) + y_wrapper.bandwidth() - 3; })
        .text(function(d){ return d.id; })
        .style("font-size", "12px")
        .on('click', function (d) {
            alert_cid(that, d.id)
          });
};

var add_image = function(that){
    // remove loading div 2
    remove_loading_div2(that);
    console.log('ADD IMAGE');
    var prev_svg = d3.select("#"+create_name('images',div_name));
    prev_svg.selectAll('g').remove();
    prev_svg.selectAll('svg').remove();

    var images = that.model.get('current_images');    
    if (images.length == 0){
        return 1;
    }

    var sts = that.model.get('selected_hotspot_series'); // selected time series
    var maximo = d3.max(sts.map(x => x.value));
    var divWidth  = document.getElementById(create_name('images',div_name)).clientWidth;
    var divHeight = document.getElementById(create_name('images',div_name)).clientHeight;


    var svg = d3.select("#"+create_name('images',div_name))
                .append("svg")
                .attr("width",  divWidth)
                .attr("height", divHeight);

    var margin_pct = {
        top: 0.10*divHeight,
        right: 0.05*divWidth,
        bottom: 0.20*divHeight,
        left: 0.05*divWidth
    };

    var width = divWidth  - margin_pct.left - margin_pct.right;
    const height = divHeight - margin_pct.top - margin_pct.bottom;    
    // const height=30;
    console.log('Height');
    console.log(divHeight);
    console.log(margin_pct.top +'   '+ margin_pct.bottom);
    console.log(height);
    const g_selected_time_series_plot = svg.append("g")
        .attr('id', 'g_images_plot')
        .attr("transform","translate(" + margin_pct.left + "," + margin_pct.top + ")")
        .attr("width",  width)
        .attr("height", height);


    let x = d3.scaleLinear()
      .domain([1, sts.length])
      .range([0, width]);


    let y = d3.scaleLinear()
      .domain([0,maximo])
      .range([height, 0])

    let area = d3.area()
      .x(function(d){ return x(d.month); })
      .y1(function(d) { return y(d.value); })
      .y0(y(0))
      .curve(d3.curveMonotoneX);
    
    g_selected_time_series_plot.append("g")
      .attr("class", "axisWhite")
      .attr("transform", "translate(0, " + height + ")")
      .call(d3.axisBottom(x))

    // JOIN
    var area_path = g_selected_time_series_plot.selectAll(".areas")
        .data(sts)
        .enter().append("path")
        .attr("class", "areas")
        .attr("stroke","black")
        .attr("stroke-opacity",1)
        .attr("opacity",1)
        .attr("d", function(d){ return area(sts); })    
        .style("fill","#82bcfa");

    // process image data
    // var fecha_inicio  = "20120515";
    // 2020-01-01
    var fecha_inicio  = that.model.get('fecha_inicio');
    var year_ini        = fecha_inicio.substring(0,4);
    var month_ini       = fecha_inicio.substring(5,7);
    var day_ini         = fecha_inicio.substring(8,10);
    var fecha_fin  = that.model.get('fecha_fin');
    var year_fin        = fecha_fin.substring(0,4);
    var month_fin       = fecha_fin.substring(5,7);
    var day_fin         = fecha_fin.substring(8,10)
    var InicialDate =  new Date(year_ini,month_ini,day_ini);
    var finalDate = new Date(year_fin,month_fin,day_fin);
    var img_data = [];
    for (let i = 0; i<images.length; i++){
        ActualDate = new Date(images[i]['year'],images[i]['month']-1,1);
        if(ActualDate<=finalDate && ActualDate>=InicialDate){
            var diff = monthDiff(InicialDate,ActualDate);
            console.log('DIFF');
            console.log(ActualDate);
            console.log(x(diff+1));


            var blob = new Blob([images[i]['bytes'].buffer]);
            var objectURL = URL.createObjectURL(blob);
            img_data.push({
                'diff':diff,
                'name':images[i]['year']+' / '+images[i]['month'],
                'url': objectURL
            });
        }
    }
    // console.log('img_data');
    // console.log(img_data);

    var selected;
    const select_dots = g_selected_time_series_plot.selectAll(".MyNodes")
        .data(img_data)
        .enter().append('circle')
        .attr('cx', function(d) {
            return x(d.diff+1);
        })
        .attr('cy', function(d) {
            return y(sts[d.diff].value);
        })
        .attr('r', 5 )
        .attr("fill",'#c6a1ff')
        .attr('stroke','black')
        .style('cursor','pointer')
        .on("click", function(d){
            if(!selected){
                selected = this;
                d3.select(selected).style('fill', '#9a59ff').attr('r', 7 );
            } 
            else {
                d3.select(selected).style('fill', '#c6a1ff').attr('r', 5 );
                selected = this;
                d3.select(selected).style('fill', '#9a59ff').attr('r', 7 );
            }
            let img_viz = document.getElementById(create_name('img_viz',div_name));
            let img_date = document.getElementById(create_name('img_date',div_name));
            img_viz.src = d.url;
            img_date.innerHTML = d.name;
        });
}

var set_links = function (that) {
    const collection = document.getElementsByClassName("group1");
    for (let i = 0; i < collection.length; i++){
        collection[i].onclick = function(){
            var btn_val = create_name(collection[i].getAttribute('data-value'), div_name);
            var previous_visible = document.getElementsByClassName("element_visible views1")[0].id;
            document.getElementById(previous_visible).classList.remove('element_visible');
            document.getElementById(previous_visible).classList.add('element_hidden');
            // cambiar actual oculto -> visible
            document.getElementById(btn_val).classList.remove('element_hidden');
            document.getElementById(btn_val).classList.add('element_visible');
        }
    }
    // cluster - group
    //const cluster_chart = document.getElementById(create_name('clusters',div_name));
    //const group_chart = document.getElementById(create_name('clusters',div_name));
}

var render_total_header = function(that) {
    console.log('RENDER HEADER');
    var header1  = document.getElementById('all_nodes');
    var total_crimes = that.model.get('total_crimes');
    var total_hotspots = that.model.get('total_hotspots');
    var calculated_crimes = that.model.get('calculated_crimes');
    var calculated_hotspots = that.model.get('calculated_hotspots');
    var crimes_percent = ((calculated_crimes/total_crimes)*100).toFixed(2);
    var hotspots_percent = ((calculated_hotspots/total_hotspots)*100).toFixed(2);
    
    header1.textContent = "Crimes: " + crimes_percent + "% (" + calculated_crimes + " / " + total_crimes + " ) | ";
    header1.textContent += "Nodes: " + hotspots_percent + "% (" + calculated_hotspots + " / " + total_hotspots + " )";

};
var render_selected_header = function(that) {
    console.log('RENDER SELECTED HEADER');
    var header1  = document.getElementById('selected_nodes');
    var calculated_crimes = that.model.get('calculated_crimes');
    var calculated_hotspots = that.model.get('calculated_hotspots');
    var selected_crimes = that.model.get('selected_crimes');
    var selected_hotspots = that.model.get('selected_hotspots');
    var crimes_percent = ((selected_crimes/calculated_crimes)*100).toFixed(2);
    var hotspots_percent = ((selected_hotspots/calculated_hotspots)*100).toFixed(2);

    header1.textContent = "Crimes: " + crimes_percent + "% (" + selected_crimes + " / " + calculated_crimes + " ) | ";
    header1.textContent += "Nodes: " + hotspots_percent + "% (" + selected_hotspots + " / " + calculated_hotspots + " )";    

};

var add_loading_div1 = function(that){
    let element = document.getElementById(create_name('loading_div1', div_name));
    element.classList.add('spinner1');
}
var remove_loading_div1 = function(that){
    let element = document.getElementById(create_name('loading_div1', div_name));
    element.classList.remove('spinner1');
}

var add_loading_div2 = function(that){
    let element = document.getElementById(create_name('loading_div2', div_name));
    element.classList.add('spinner2');
}
var remove_loading_div2 = function(that){
    let element = document.getElementById(create_name('loading_div2', div_name));
    element.classList.remove('spinner2');
}

var view = {
    create: create,
    render_probint_scatter:render_probint_scatter,
    render_cluster_plot:render_cluster_plot,
    render_group_chart_plot:render_group_chart_plot,
    render_time_series:render_time_series,
    render_map:render_map,
    render_total_header: render_total_header,
    render_selected_header: render_selected_header,
    add_image
};

module.exports = view;

/***/ }),

/***/ "./lib/d3-tip.js":
/*!***********************!*\
  !*** ./lib/d3-tip.js ***!
  \***********************/
/***/ (() => {

// d3.tip
// Copyright (c) 2013 Justin Palmer
// ES6 / D3 v4 Adaption Copyright (c) 2016 Constantin Gavrilete
// Removal of ES6 for D3 v4 Adaption Copyright (c) 2016 David Gotz
//
// Tooltips for d3.js SVG visualizations

d3.functor = function functor(v) {
  return typeof v === "function" ? v : function() {
    return v;
  };
};

d3.tip = function() {

  var direction = d3_tip_direction,
      offset    = d3_tip_offset,
      html      = d3_tip_html,
      node      = initNode(),
      svg       = null,
      point     = null,
      target    = null

  function tip(vis) {
    svg = getSVGNode(vis)
    point = svg.createSVGPoint()
    document.body.appendChild(node)
  }

  // Public - show the tooltip on the screen
  //
  // Returns a tip
  tip.show = function() {
    var args = Array.prototype.slice.call(arguments)
    if(args[args.length - 1] instanceof SVGElement) target = args.pop()

    var content = html.apply(this, args),
        poffset = offset.apply(this, args),
        dir     = direction.apply(this, args),
        nodel   = getNodeEl(),
        i       = directions.length,
        coords,
        scrollTop  = document.documentElement.scrollTop || document.body.scrollTop,
        scrollLeft = document.documentElement.scrollLeft || document.body.scrollLeft

    nodel.html(content)
      .style('position', 'absolute')
      .style('opacity', 1)
      .style('pointer-events', 'all')

    while(i--) nodel.classed(directions[i], false)
    coords = direction_callbacks[dir].apply(this)
    nodel.classed(dir, true)
      .style('top', (coords.top +  poffset[0]) + scrollTop + 'px')
      .style('left', (coords.left + poffset[1]) + scrollLeft + 'px')

    return tip
  }

  // Public - hide the tooltip
  //
  // Returns a tip
  tip.hide = function() {
    var nodel = getNodeEl()
    nodel
      .style('opacity', 0)
      .style('pointer-events', 'none')
    return tip
  }

  // Public: Proxy attr calls to the d3 tip container.  Sets or gets attribute value.
  //
  // n - name of the attribute
  // v - value of the attribute
  //
  // Returns tip or attribute value
  tip.attr = function(n, v) {
    if (arguments.length < 2 && typeof n === 'string') {
      return getNodeEl().attr(n)
    } else {
      var args =  Array.prototype.slice.call(arguments)
      d3.selection.prototype.attr.apply(getNodeEl(), args)
    }

    return tip
  }

  // Public: Proxy style calls to the d3 tip container.  Sets or gets a style value.
  //
  // n - name of the property
  // v - value of the property
  //
  // Returns tip or style property value
  tip.style = function(n, v) {
    // debugger;
    if (arguments.length < 2 && typeof n === 'string') {
      return getNodeEl().style(n)
    } else {
      var args = Array.prototype.slice.call(arguments);
      if (args.length === 1) {
        var styles = args[0];
        Object.keys(styles).forEach(function(key) {
          return d3.selection.prototype.style.apply(getNodeEl(), [key, styles[key]]);
        });
      }
    }

    return tip
  }

  // Public: Set or get the direction of the tooltip
  //
  // v - One of n(north), s(south), e(east), or w(west), nw(northwest),
  //     sw(southwest), ne(northeast) or se(southeast)
  //
  // Returns tip or direction
  tip.direction = function(v) {
    if (!arguments.length) return direction
    direction = v == null ? v : d3.functor(v)

    return tip
  }

  // Public: Sets or gets the offset of the tip
  //
  // v - Array of [x, y] offset
  //
  // Returns offset or
  tip.offset = function(v) {
    if (!arguments.length) return offset
    offset = v == null ? v : d3.functor(v)

    return tip
  }

  // Public: sets or gets the html value of the tooltip
  //
  // v - String value of the tip
  //
  // Returns html value or tip
  tip.html = function(v) {
    if (!arguments.length) return html
    html = v == null ? v : d3.functor(v)

    return tip
  }

  // Public: destroys the tooltip and removes it from the DOM
  //
  // Returns a tip
  tip.destroy = function() {
    if(node) {
      getNodeEl().remove();
      node = null;
    }
    return tip;
  }

  function d3_tip_direction() { return 'n' }
  function d3_tip_offset() { return [0, 0] }
  function d3_tip_html() { return ' ' }

  var direction_callbacks = {
    n:  direction_n,
    s:  direction_s,
    e:  direction_e,
    w:  direction_w,
    nw: direction_nw,
    ne: direction_ne,
    sw: direction_sw,
    se: direction_se
  };

  var directions = Object.keys(direction_callbacks);

  function direction_n() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.n.y - node.offsetHeight,
      left: bbox.n.x - node.offsetWidth / 2
    }
  }

  function direction_s() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.s.y,
      left: bbox.s.x - node.offsetWidth / 2
    }
  }

  function direction_e() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.e.y - node.offsetHeight / 2,
      left: bbox.e.x
    }
  }

  function direction_w() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.w.y - node.offsetHeight / 2,
      left: bbox.w.x - node.offsetWidth
    }
  }

  function direction_nw() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.nw.y - node.offsetHeight,
      left: bbox.nw.x - node.offsetWidth
    }
  }

  function direction_ne() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.ne.y - node.offsetHeight,
      left: bbox.ne.x
    }
  }

  function direction_sw() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.sw.y,
      left: bbox.sw.x - node.offsetWidth
    }
  }

  function direction_se() {
    var bbox = getScreenBBox()
    return {
      top:  bbox.se.y,
      left: bbox.e.x
    }
  }

  function initNode() {
    var node = d3.select(document.createElement('div'))
    node
      .style('position', 'absolute')
      .style('top', 0)
      .style('opacity', 0)
      .style('pointer-events', 'none')
      .style('box-sizing', 'border-box')

    return node.node()
  }

  function getSVGNode(el) {
    el = el.node()
    if(el.tagName.toLowerCase() === 'svg')
      return el

    return el.ownerSVGElement
  }

  function getNodeEl() {
    if(node === null) {
      node = initNode();
      // re-add node to DOM
      document.body.appendChild(node);
    };
    return d3.select(node);
  }

  // Private - gets the screen coordinates of a shape
  //
  // Given a shape on the screen, will return an SVGPoint for the directions
  // n(north), s(south), e(east), w(west), ne(northeast), se(southeast), nw(northwest),
  // sw(southwest).
  //
  //    +-+-+
  //    |   |
  //    +   +
  //    |   |
  //    +-+-+
  //
  // Returns an Object {n, s, e, w, nw, sw, ne, se}
  function getScreenBBox() {
    var targetel   = target || d3.event.target;

    while ('undefined' === typeof targetel.getScreenCTM && 'undefined' === targetel.parentNode) {
        targetel = targetel.parentNode;
    }

    var bbox       = {},
        matrix     = targetel.getScreenCTM(),
        tbbox      = targetel.getBBox(),
        width      = tbbox.width,
        height     = tbbox.height,
        x          = tbbox.x,
        y          = tbbox.y

    point.x = x
    point.y = y
    bbox.nw = point.matrixTransform(matrix)
    point.x += width
    bbox.ne = point.matrixTransform(matrix)
    point.y += height
    bbox.se = point.matrixTransform(matrix)
    point.x -= width
    bbox.sw = point.matrixTransform(matrix)
    point.y -= height / 2
    bbox.w  = point.matrixTransform(matrix)
    point.x += width
    bbox.e = point.matrixTransform(matrix)
    point.x -= width / 2
    point.y -= height / 2
    bbox.n = point.matrixTransform(matrix)
    point.y += height
    bbox.s = point.matrixTransform(matrix)

    return bbox
  }

  return tip
};

/***/ }),

/***/ "./lib/example.js":
/*!************************!*\
  !*** ./lib/example.js ***!
  \************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

/* 
Change log:
- import the scatterplot as d3_scatterplot
- rename HelloModel and HelloView as ScatterplotModel and ScatterplotView
*/
var widgets = __webpack_require__(/*! @jupyter-widgets/base */ "webpack/sharing/consume/default/@jupyter-widgets/base");
var d3_scatterplot = __webpack_require__(/*! ./scatterplot.js */ "./lib/scatterplot.js");
var d3_cripav4 = __webpack_require__(/*! ./cripav4.js */ "./lib/cripav4.js");
var d3_simplemap = __webpack_require__(/*! ./simple_map.js */ "./lib/simple_map.js");
var d3_simplemap2 = __webpack_require__(/*! ./simple_map2.js */ "./lib/simple_map2.js");
var d3_comparison_map = __webpack_require__(/*! ./comparison_map.js */ "./lib/comparison_map.js");
var _ = __webpack_require__(/*! lodash */ "webpack/sharing/consume/default/lodash/lodash");

// See example.py for the kernel counterpart to this file.


// Custom Model. Custom widgets models must at least provide default values
// for model attributes, including
//
//  - `_view_name`
//  - `_view_module`
//  - `_view_module_version`
//
//  - `_model_name`
//  - `_model_module`
//  - `_model_module_version`
//
//  when different from the base class.

// When serialiazing the entire widget state for embedding, only values that
// differ from the defaults will be specified.
var ScatterplotModel = widgets.DOMWidgetModel.extend({
    defaults: _.extend(widgets.DOMWidgetModel.prototype.defaults(), {
        _model_name : 'ScatterplotModel',
        _view_name : 'ScatterplotView',
        _model_module : 'jupyter_d3_widget',
        _view_module : 'jupyter_d3_widget',
        _model_module_version : '0.1.0',
        _view_module_version : '0.1.0',
        value : [],
        clicked_dot: -1,
    })
});


// Custom View. Renders the widget model.
var ScatterplotView = widgets.DOMWidgetView.extend({
    // Defines how the widget gets rendered into the DOM
    render: function() {
        // explicit
        let that = this;

        this.loadAndCreateToolElement();


        // Observe changes in the value traitlet in Python, and define
        // a custom callback.
        that.model.on('change:value', that.value_changed, that);

        // debug in browser
        window.dom = that.el;
    },

    value_changed: function() {
        let that = this;
        d3_projection.render_scatterplot(that);
    },

    loadAndCreateToolElement: function() {
        let that = this;

        // scatterplot rendering
        d3_scatterplot.create(that);
    },
});

// Test widget
var TestwidgetModel = widgets.DOMWidgetModel.extend({
    defaults: _.extend(widgets.DOMWidgetModel.prototype.defaults(), {
        _model_name : 'TestwidgetModel',
        _view_name : 'TestwidgetView',
        _model_module : 'jupyter_d3_widget',
        _view_module : 'jupyter_d3_widget',
        _model_module_version : '0.1.0',
        _view_module_version : '0.1.0',
        value : [],
        clicked_dot: -1,
    })
});


// Custom View. Renders the widget model.
var TestwidgetView = widgets.DOMWidgetView.extend({
    // Defines how the widget gets rendered into the DOM
    render: function() {
        // explicit
        let that = this;

        this.loadAndCreateToolElement();


        // Observe changes in the value traitlet in Python, and define
        // a custom callback.
        that.model.on('change:projected_values', that.pj_changed, that);        

        // debug in browser
        window.dom = that.el;
    },

    pj_changed: function() {
        let that = this;
        d3_testwidget.update_testwidget(that);
    },

    loadAndCreateToolElement: function() {
        let that = this;

        // scatterplot rendering
        d3_testwidget.create(that);
    },
});


var CriPAV4Model = widgets.DOMWidgetModel.extend({
    defaults: _.extend(widgets.DOMWidgetModel.prototype.defaults(), {
        _model_name : 'CriPAV4Model',
        _view_name : 'CriPAV4View',
        _model_module : 'jupyter_d3_widget',
        _view_module : 'jupyter_d3_widget',
        _model_module_version : '0.1.0',
        _view_module_version : '0.1.0',
        value : []
    })
});


// Custom View. Renders the widget model.
var CriPAV4View = widgets.DOMWidgetView.extend({
    // Defines how the widget gets rendered into the DOM
    render: function() {
        // explicit
        let that = this;

        this.loadAndCreateToolElement();


        // Observe changes in the value traitlet in Python, and define
        // a custom callback.
        // that.model.on('change:projected_values', that.pj_changed, that);        
        that.model.on('change:data_cluster', that.update_clusters, that);
        that.model.on('change:current_selection', that.lasso_selection, that);
        that.model.on('change:current_time_series', that.time_series_selection, that);
        that.model.on('change:current_images', that.send_images, that);
        // debug in browser
        window.dom = that.el;
    },

    loadAndCreateToolElement: function() {
        let that = this;

        // scatterplot rendering
        d3_cripav4.create(that);
    },
    update_clusters: function() {
        let that = this;
        d3_cripav4.render_probint_scatter(that);
        d3_cripav4.render_cluster_plot(that);
        d3_cripav4.render_map(that);
        d3_cripav4.render_group_chart_plot(that);
        d3_cripav4.render_total_header(that);
    },
    lasso_selection: function() {
        let that = this;
        d3_cripav4.render_probint_scatter(that);
        d3_cripav4.render_map(that);
        d3_cripav4.render_selected_header(that);
    },
    time_series_selection: function() {
        let that = this;
        d3_cripav4.render_time_series(that);
    },
    send_images: function() {
        let that = this;
        d3_cripav4.add_image(that);
    }
});


var SimplemapModel = widgets.DOMWidgetModel.extend({
    defaults: _.extend(widgets.DOMWidgetModel.prototype.defaults(), {
        _model_name : 'SimplemapModel',
        _view_name : 'SimplemapView',
        _model_module : 'jupyter_d3_widget',
        _view_module : 'jupyter_d3_widget',
        _model_module_version : '0.1.0',
        _view_module_version : '0.1.0',
        value : []
    })
});


// Custom View. Renders the widget model.
var SimplemapView = widgets.DOMWidgetView.extend({
    // Defines how the widget gets rendered into the DOM
    render: function() {
        // explicit
        let that = this;

        this.loadAndCreateToolElement();


        // Observe changes in the value traitlet in Python, and define
        // a custom callback.
        // that.model.on('change:projected_values', that.pj_changed, that);        

        // debug in browser
        window.dom = that.el;
    },

    pj_changed: function() {
        let that = this;
        // d3_testwidget.update_testwidget(that);
    },

    loadAndCreateToolElement: function() {
        let that = this;

        // scatterplot rendering
        d3_simplemap.create(that);
    },
});

var Simplemap2Model = widgets.DOMWidgetModel.extend({
    defaults: _.extend(widgets.DOMWidgetModel.prototype.defaults(), {
        _model_name : 'Simplemap2Model',
        _view_name : 'Simplemap2View',
        _model_module : 'jupyter_d3_widget',
        _view_module : 'jupyter_d3_widget',
        _model_module_version : '0.1.0',
        _view_module_version : '0.1.0',
        value : []
    })
});


// Custom View. Renders the widget model.
var Simplemap2View = widgets.DOMWidgetView.extend({
    // Defines how the widget gets rendered into the DOM
    render: function() {
        // explicit
        let that = this;

        this.loadAndCreateToolElement();


        // Observe changes in the value traitlet in Python, and define
        // a custom callback.
        // that.model.on('change:projected_values', that.pj_changed, that);        

        // debug in browser
        window.dom = that.el;
    },

    pj_changed: function() {
        let that = this;
        // d3_testwidget.update_testwidget(that);
    },

    loadAndCreateToolElement: function() {
        let that = this;

        // scatterplot rendering
        d3_simplemap2.create(that);
    },
});

var ComparisonMapModel = widgets.DOMWidgetModel.extend({
    defaults: _.extend(widgets.DOMWidgetModel.prototype.defaults(), {
        _model_name : 'ComparisonMapModel',
        _view_name : 'ComparisonMapView',
        _model_module : 'jupyter_d3_widget',
        _view_module : 'jupyter_d3_widget',
        _model_module_version : '6.6.6',
        _view_module_version : '6.6.6',
        value : []
    })
});


// Custom View. Renders the widget model.
var ComparisonMapView = widgets.DOMWidgetView.extend({
    // Defines how the widget gets rendered into the DOM
    render: function() {
        // explicit
        let that = this;

        this.loadAndCreateToolElement();


        // Observe changes in the value traitlet in Python, and define
        // a custom callback.
        // that.model.on('change:projected_values', that.pj_changed, that);        

        // debug in browser
        window.dom = that.el;
    },

    pj_changed: function() {
        let that = this;
        // d3_testwidget.update_testwidget(that);
    },

    loadAndCreateToolElement: function() {
        let that = this;

        // scatterplot rendering
        d3_comparison_map.create(that);
    },
});

module.exports = {
    ScatterplotModel: ScatterplotModel,
    ScatterplotView: ScatterplotView,
    TestwidgetModel: TestwidgetModel,
    TestwidgetView: TestwidgetView,
    CriPAV4View: CriPAV4View,
    CriPAV4Model: CriPAV4Model,
    SimplemapView: SimplemapView,
    SimplemapModel: SimplemapModel,
    Simplemap2View: Simplemap2View,
    Simplemap2Model: Simplemap2Model,
    ComparisonMapView: ComparisonMapView,
    ComparisonMapModel: ComparisonMapModel,
};

/***/ }),

/***/ "./lib/index.js":
/*!**********************!*\
  !*** ./lib/index.js ***!
  \**********************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Export widget models and views, and the npm package version number.
module.exports = __webpack_require__(/*! ./example.js */ "./lib/example.js");
module.exports.version = __webpack_require__(/*! ../package.json */ "./package.json").version;

/***/ }),

/***/ "./lib/scatterplot.js":
/*!****************************!*\
  !*** ./lib/scatterplot.js ***!
  \****************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var d3 = __webpack_require__(/*! d3 */ "webpack/sharing/consume/default/d3/d3");
window.d3=d3;
__webpack_require__(/*! ./scatterplot.css */ "./lib/scatterplot.css");

// constant for svg
var margin = {top: 10, right: 30, bottom: 30, left: 60},
    width = 460 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;
var xScale, yScale;

function create(that) {
    console.log('start create');

    // intialize the html
    that.el.setAttribute('class', 'd3-scatterplot');
    that.el.innerHTML = `
        <div id="my_dataviz">
            <svg class="scatterplot-svg"></svg>
        </div>
    `
    window.dom = that.el;
    render(that);
}

function render(that) {
    console.log('start render');
    var svgElmt = that.el.getElementsByClassName('scatterplot-svg')[0];
    svgElmt.setAttribute('width', width + margin.left + margin.right);
    svgElmt.setAttribute('height', height + margin.top + margin.bottom);

    var svg = d3.select(svgElmt);
    window.svg = svg;

    // append the svg object to the body of the page
    svg = svg.append("g")
        .attr('id', 'plot')
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

    // Add X axis
    xScale = d3.scaleLinear()
        .domain([0, 4000])
        .range([ 0, width ]);
    svg.append("g")
        .attr('id', 'x-axis')
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(xScale));

    // Add Y axis
    yScale = d3.scaleLinear()
        .domain([0, 500000])
        .range([ height, 0]);
    svg.append("g")
        .attr('id', 'y-axis')
        .call(d3.axisLeft(yScale));

    render_scatterplot(that);
}

function render_scatterplot(that) {
    var svg = window.svg.select('#plot');

    //Read the data
    data = that.model.get('value');
    // Add dots
    svg.append('g')
        .selectAll("circle")
        .data(data)
        .enter()
        .append("circle")
          .attr('class', 'dot')        
          .attr("cx", function (d) { return xScale(d.GrLivArea); } )
          .attr("cy", function (d) { return yScale(d.SalePrice); } )
          .attr("r", 5.5)
}

var view = {
    create: create,
    render_scatterplot: render_scatterplot,
};

module.exports = view;

/***/ }),

/***/ "./lib/simple_map.js":
/*!***************************!*\
  !*** ./lib/simple_map.js ***!
  \***************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var d3 = __webpack_require__(/*! d3 */ "webpack/sharing/consume/default/d3/d3");
var deckgl_core = __webpack_require__(/*! @deck.gl/core */ "webpack/sharing/consume/default/@deck.gl/core/@deck.gl/core?d123");
var deckgl_layers = __webpack_require__(/*! @deck.gl/layers */ "webpack/sharing/consume/default/@deck.gl/layers/@deck.gl/layers");
var deckgl_mapbox = __webpack_require__(/*! @deck.gl/mapbox */ "webpack/sharing/consume/default/@deck.gl/mapbox/@deck.gl/mapbox");
var mapbox_gl = __webpack_require__(/*! mapbox-gl */ "webpack/sharing/consume/default/mapbox-gl/mapbox-gl");


window.d3=d3;
window.deckgl_core=deckgl_core;
window.deckgl_layers=deckgl_layers;
window.deckgl_mapbox = deckgl_mapbox;
window.mapbox_gl = mapbox_gl;

// constant for svg (probint)
var margin = {top: 10, right: 10, bottom: 10, left: 10},
    width = 500 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;
var xScale, yScale;
var map;
var deckOverlay;


var create = function (that) {
    console.log('start create');

    // intialize the html
    that.el.setAttribute('class', 'd3-cripav1');
    var div_name = "map_"+that.model.get('_div_name');
    that.el.innerHTML = `
        <div id="container_row1" style="width:100%; height:600px;background-color:#f5f9fa;display: flex;justify-content: center;align-items: center;">
            <div id="`+div_name+`" style="width:100%; height:550px;margin: 10px;background-color:#f0f0f0;  box-shadow: 5px 10px 18px #888888;border: 1px solid;">
            </div>
        </div>
    `
    window.dom = that.el;

    setTimeout(function(){
        var div_name = "map_"+that.model.get('_div_name');
        map = new mapbox_gl.Map({
            container: div_name,
            style: 'mapbox://styles/mapbox/light-v9',
            accessToken: 'pk.eyJ1IjoiZ2VnYXphIiwiYSI6ImNqOHNkMXV0cDA4bGgzM3A4OHZwOHNxYWUifQ.cEY6vV7UqVGv7Qd3WxI-dA',
            center: [-46.634731, -23.548682],
            zoom: 12,
            antialias: true,
            bearing: 30,
            pitch: 0,
            attributionControl: false
        });
        deckOverlay = new deckgl_mapbox.MapboxOverlay({
                interleaved:true,
                layers: []
        });
        map.addControl(deckOverlay);
        var data = that.model.get('values');
        // console.log('DATA');
        // console.log(data);
        var data_layer = new deckgl_layers.ColumnLayer({
                    data: data,
                    diskResolution: 12,
                    radius:that.model.get('radius'),
                    extruded: true,
                    pickable: true,
                    elevationScale: 10,
                    getPosition: d => [d.lng,d.lat],
                    // getFillColor: d=> [],
                    getFillColor: [200,100,50],
                    getLineColor: [0, 0, 0],
                    getElevation:d=> that.model.get('elevation'),
                    opacity: that.model.get('opacity')
                });
    
        deckOverlay.setProps({
            layers: [data_layer]
        })   
    }, 300);
}

var render = function(that) {
    console.log('start render');

    render_simplemap(that);
}

var render_simplemap = function (that) {
    console.log('START RENDER SIMPLEMAP');
             
}

var view = {
    create: create,
    render_simplemap: render_simplemap
};

module.exports = view;

/***/ }),

/***/ "./lib/simple_map2.js":
/*!****************************!*\
  !*** ./lib/simple_map2.js ***!
  \****************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var d3 = __webpack_require__(/*! d3 */ "webpack/sharing/consume/default/d3/d3");
var deckgl_core = __webpack_require__(/*! @deck.gl/core */ "webpack/sharing/consume/default/@deck.gl/core/@deck.gl/core?d123");
var deckgl_layers = __webpack_require__(/*! @deck.gl/layers */ "webpack/sharing/consume/default/@deck.gl/layers/@deck.gl/layers");
var deckgl_mapbox = __webpack_require__(/*! @deck.gl/mapbox */ "webpack/sharing/consume/default/@deck.gl/mapbox/@deck.gl/mapbox");
var mapbox_gl = __webpack_require__(/*! mapbox-gl */ "webpack/sharing/consume/default/mapbox-gl/mapbox-gl");


window.d3=d3;
window.deckgl_core=deckgl_core;
window.deckgl_layers=deckgl_layers;
window.deckgl_mapbox = deckgl_mapbox;
window.mapbox_gl = mapbox_gl;

// constant for svg (probint)
var margin = {top: 10, right: 10, bottom: 10, left: 10},
    width = 500 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;
var xScale, yScale;
var map;
var deckOverlay;


var create = function (that) {
    console.log('start create');

    // intialize the html
    that.el.setAttribute('class', 'd3-cripav1');
    var div_name = "map_"+that.model.get('_div_name');
    that.el.innerHTML = `
        <div id="container_row1" style="width:100%; height:550px;background-color:#f5f9fa;display: flex;justify-content: center;align-items: center;">
            <div id="`+div_name+`" style="width:100%; height:500px;margin: 10px;background-color:#f0f0f0;  box-shadow: 5px 10px 18px #888888;border: 1px solid;">
            </div>
        </div>
    `
    window.dom = that.el;

    setTimeout(function(){
        var div_name = "map_"+that.model.get('_div_name');
        map = new mapbox_gl.Map({
            container: div_name,
            style: 'mapbox://styles/mapbox/light-v9',
            accessToken: 'pk.eyJ1IjoiZ2VnYXphIiwiYSI6ImNqOHNkMXV0cDA4bGgzM3A4OHZwOHNxYWUifQ.cEY6vV7UqVGv7Qd3WxI-dA',
            center: [-46.634731, -23.548682],
            zoom: 12,
            antialias: true,
            bearing: 30,
            pitch: 0,
            attributionControl: false
        });
        deckOverlay = new deckgl_mapbox.MapboxOverlay({
                interleaved:true,
                layers: []
        });
        map.addControl(deckOverlay);
        var data = that.model.get('values');
        console.log('DATA');
        var cant = data.map(d => d.cant);
        console.log(cant);
        var CrimeScale = d3.scaleLinear()
                    .domain(d3.extent(cant)).nice()
                    .range([0,100]);
        var data_layer = new deckgl_layers.ColumnLayer({
                    data: data,
                    diskResolution: 12,
                    radius:that.model.get('radius'),
                    extruded: true,
                    pickable: true,
                    elevationScale: 1,
                    getPosition: d => [d.lng,d.lat],
                    // getFillColor: d=> [],
                    getFillColor: [200,100,50],
                    getLineColor: [0, 0, 0],
                    getElevation: d=> CrimeScale(d.cant),
                    opacity: that.model.get('opacity')
                });
    
        deckOverlay.setProps({
            layers: [data_layer]
        })   
    }, 300);
}

var render = function(that) {
    console.log('start render');

    render_simplemap(that);
}

var render_simplemap = function (that) {
    console.log('START RENDER SIMPLEMAP');
             
}

var view = {
    create: create,
    render_simplemap: render_simplemap
};

module.exports = view;

/***/ }),

/***/ "./node_modules/css-loader/dist/runtime/api.js":
/*!*****************************************************!*\
  !*** ./node_modules/css-loader/dist/runtime/api.js ***!
  \*****************************************************/
/***/ ((module) => {

"use strict";


/*
  MIT License http://www.opensource.org/licenses/mit-license.php
  Author Tobias Koppers @sokra
*/
// css base code, injected by the css-loader
// eslint-disable-next-line func-names
module.exports = function (useSourceMap) {
  var list = []; // return the list of modules as css string

  list.toString = function toString() {
    return this.map(function (item) {
      var content = cssWithMappingToString(item, useSourceMap);

      if (item[2]) {
        return "@media ".concat(item[2], " {").concat(content, "}");
      }

      return content;
    }).join('');
  }; // import a list of modules into the list
  // eslint-disable-next-line func-names


  list.i = function (modules, mediaQuery, dedupe) {
    if (typeof modules === 'string') {
      // eslint-disable-next-line no-param-reassign
      modules = [[null, modules, '']];
    }

    var alreadyImportedModules = {};

    if (dedupe) {
      for (var i = 0; i < this.length; i++) {
        // eslint-disable-next-line prefer-destructuring
        var id = this[i][0];

        if (id != null) {
          alreadyImportedModules[id] = true;
        }
      }
    }

    for (var _i = 0; _i < modules.length; _i++) {
      var item = [].concat(modules[_i]);

      if (dedupe && alreadyImportedModules[item[0]]) {
        // eslint-disable-next-line no-continue
        continue;
      }

      if (mediaQuery) {
        if (!item[2]) {
          item[2] = mediaQuery;
        } else {
          item[2] = "".concat(mediaQuery, " and ").concat(item[2]);
        }
      }

      list.push(item);
    }
  };

  return list;
};

function cssWithMappingToString(item, useSourceMap) {
  var content = item[1] || ''; // eslint-disable-next-line prefer-destructuring

  var cssMapping = item[3];

  if (!cssMapping) {
    return content;
  }

  if (useSourceMap && typeof btoa === 'function') {
    var sourceMapping = toComment(cssMapping);
    var sourceURLs = cssMapping.sources.map(function (source) {
      return "/*# sourceURL=".concat(cssMapping.sourceRoot || '').concat(source, " */");
    });
    return [content].concat(sourceURLs).concat([sourceMapping]).join('\n');
  }

  return [content].join('\n');
} // Adapted from convert-source-map (MIT)


function toComment(sourceMap) {
  // eslint-disable-next-line no-undef
  var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));
  var data = "sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(base64);
  return "/*# ".concat(data, " */");
}

/***/ }),

/***/ "./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":
/*!****************************************************************************!*\
  !*** ./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js ***!
  \****************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

"use strict";


var isOldIE = function isOldIE() {
  var memo;
  return function memorize() {
    if (typeof memo === 'undefined') {
      // Test for IE <= 9 as proposed by Browserhacks
      // @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805
      // Tests for existence of standard globals is to allow style-loader
      // to operate correctly into non-standard environments
      // @see https://github.com/webpack-contrib/style-loader/issues/177
      memo = Boolean(window && document && document.all && !window.atob);
    }

    return memo;
  };
}();

var getTarget = function getTarget() {
  var memo = {};
  return function memorize(target) {
    if (typeof memo[target] === 'undefined') {
      var styleTarget = document.querySelector(target); // Special case to return head of iframe instead of iframe itself

      if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {
        try {
          // This will throw an exception if access to iframe is blocked
          // due to cross-origin restrictions
          styleTarget = styleTarget.contentDocument.head;
        } catch (e) {
          // istanbul ignore next
          styleTarget = null;
        }
      }

      memo[target] = styleTarget;
    }

    return memo[target];
  };
}();

var stylesInDom = [];

function getIndexByIdentifier(identifier) {
  var result = -1;

  for (var i = 0; i < stylesInDom.length; i++) {
    if (stylesInDom[i].identifier === identifier) {
      result = i;
      break;
    }
  }

  return result;
}

function modulesToDom(list, options) {
  var idCountMap = {};
  var identifiers = [];

  for (var i = 0; i < list.length; i++) {
    var item = list[i];
    var id = options.base ? item[0] + options.base : item[0];
    var count = idCountMap[id] || 0;
    var identifier = "".concat(id, " ").concat(count);
    idCountMap[id] = count + 1;
    var index = getIndexByIdentifier(identifier);
    var obj = {
      css: item[1],
      media: item[2],
      sourceMap: item[3]
    };

    if (index !== -1) {
      stylesInDom[index].references++;
      stylesInDom[index].updater(obj);
    } else {
      stylesInDom.push({
        identifier: identifier,
        updater: addStyle(obj, options),
        references: 1
      });
    }

    identifiers.push(identifier);
  }

  return identifiers;
}

function insertStyleElement(options) {
  var style = document.createElement('style');
  var attributes = options.attributes || {};

  if (typeof attributes.nonce === 'undefined') {
    var nonce =  true ? __webpack_require__.nc : 0;

    if (nonce) {
      attributes.nonce = nonce;
    }
  }

  Object.keys(attributes).forEach(function (key) {
    style.setAttribute(key, attributes[key]);
  });

  if (typeof options.insert === 'function') {
    options.insert(style);
  } else {
    var target = getTarget(options.insert || 'head');

    if (!target) {
      throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");
    }

    target.appendChild(style);
  }

  return style;
}

function removeStyleElement(style) {
  // istanbul ignore if
  if (style.parentNode === null) {
    return false;
  }

  style.parentNode.removeChild(style);
}
/* istanbul ignore next  */


var replaceText = function replaceText() {
  var textStore = [];
  return function replace(index, replacement) {
    textStore[index] = replacement;
    return textStore.filter(Boolean).join('\n');
  };
}();

function applyToSingletonTag(style, index, remove, obj) {
  var css = remove ? '' : obj.media ? "@media ".concat(obj.media, " {").concat(obj.css, "}") : obj.css; // For old IE

  /* istanbul ignore if  */

  if (style.styleSheet) {
    style.styleSheet.cssText = replaceText(index, css);
  } else {
    var cssNode = document.createTextNode(css);
    var childNodes = style.childNodes;

    if (childNodes[index]) {
      style.removeChild(childNodes[index]);
    }

    if (childNodes.length) {
      style.insertBefore(cssNode, childNodes[index]);
    } else {
      style.appendChild(cssNode);
    }
  }
}

function applyToTag(style, options, obj) {
  var css = obj.css;
  var media = obj.media;
  var sourceMap = obj.sourceMap;

  if (media) {
    style.setAttribute('media', media);
  } else {
    style.removeAttribute('media');
  }

  if (sourceMap && typeof btoa !== 'undefined') {
    css += "\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), " */");
  } // For old IE

  /* istanbul ignore if  */


  if (style.styleSheet) {
    style.styleSheet.cssText = css;
  } else {
    while (style.firstChild) {
      style.removeChild(style.firstChild);
    }

    style.appendChild(document.createTextNode(css));
  }
}

var singleton = null;
var singletonCounter = 0;

function addStyle(obj, options) {
  var style;
  var update;
  var remove;

  if (options.singleton) {
    var styleIndex = singletonCounter++;
    style = singleton || (singleton = insertStyleElement(options));
    update = applyToSingletonTag.bind(null, style, styleIndex, false);
    remove = applyToSingletonTag.bind(null, style, styleIndex, true);
  } else {
    style = insertStyleElement(options);
    update = applyToTag.bind(null, style, options);

    remove = function remove() {
      removeStyleElement(style);
    };
  }

  update(obj);
  return function updateStyle(newObj) {
    if (newObj) {
      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap) {
        return;
      }

      update(obj = newObj);
    } else {
      remove();
    }
  };
}

module.exports = function (list, options) {
  options = options || {}; // Force single-tag solution on IE6-9, which has a hard limit on the # of <style>
  // tags it will allow on a page

  if (!options.singleton && typeof options.singleton !== 'boolean') {
    options.singleton = isOldIE();
  }

  list = list || [];
  var lastIdentifiers = modulesToDom(list, options);
  return function update(newList) {
    newList = newList || [];

    if (Object.prototype.toString.call(newList) !== '[object Array]') {
      return;
    }

    for (var i = 0; i < lastIdentifiers.length; i++) {
      var identifier = lastIdentifiers[i];
      var index = getIndexByIdentifier(identifier);
      stylesInDom[index].references--;
    }

    var newLastIdentifiers = modulesToDom(newList, options);

    for (var _i = 0; _i < lastIdentifiers.length; _i++) {
      var _identifier = lastIdentifiers[_i];

      var _index = getIndexByIdentifier(_identifier);

      if (stylesInDom[_index].references === 0) {
        stylesInDom[_index].updater();

        stylesInDom.splice(_index, 1);
      }
    }

    lastIdentifiers = newLastIdentifiers;
  };
};

/***/ }),

/***/ "./lib/comparison_map.css":
/*!********************************!*\
  !*** ./lib/comparison_map.css ***!
  \********************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var api = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js */ "./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js");
            var content = __webpack_require__(/*! !!../node_modules/css-loader/dist/cjs.js!./comparison_map.css */ "./node_modules/css-loader/dist/cjs.js!./lib/comparison_map.css");

            content = content.__esModule ? content.default : content;

            if (typeof content === 'string') {
              content = [[module.id, content, '']];
            }

var options = {};

options.insert = "head";
options.singleton = false;

var update = api(content, options);



module.exports = content.locals || {};

/***/ }),

/***/ "./lib/cripav4.css":
/*!*************************!*\
  !*** ./lib/cripav4.css ***!
  \*************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var api = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js */ "./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js");
            var content = __webpack_require__(/*! !!../node_modules/css-loader/dist/cjs.js!./cripav4.css */ "./node_modules/css-loader/dist/cjs.js!./lib/cripav4.css");

            content = content.__esModule ? content.default : content;

            if (typeof content === 'string') {
              content = [[module.id, content, '']];
            }

var options = {};

options.insert = "head";
options.singleton = false;

var update = api(content, options);



module.exports = content.locals || {};

/***/ }),

/***/ "./lib/scatterplot.css":
/*!*****************************!*\
  !*** ./lib/scatterplot.css ***!
  \*****************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var api = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js */ "./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js");
            var content = __webpack_require__(/*! !!../node_modules/css-loader/dist/cjs.js!./scatterplot.css */ "./node_modules/css-loader/dist/cjs.js!./lib/scatterplot.css");

            content = content.__esModule ? content.default : content;

            if (typeof content === 'string') {
              content = [[module.id, content, '']];
            }

var options = {};

options.insert = "head";
options.singleton = false;

var update = api(content, options);



module.exports = content.locals || {};

/***/ }),

/***/ "./package.json":
/*!**********************!*\
  !*** ./package.json ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = JSON.parse('{"name":"jupyter_d3_widget","version":"0.1.0","description":"A Custom Jupyter Widget Library","author":"","license":"BSD-3-Clause","main":"lib/index.js","repository":{"type":"git","url":"https://github.com//jupyter_d3_widget.git"},"keywords":["jupyter","widgets","ipython","ipywidgets","jupyterlab-extension"],"files":["lib/**/*.js","dist/*.js"],"scripts":{"clean":"rimraf dist/ && rimraf ../jupyter_d3_widget/labextension/ && rimraf ../jupyter_d3_widget/nbextension","prepublish":"yarn run clean && yarn run build:prod","build":"webpack --mode=development && yarn run build:labextension:dev","build:prod":"webpack --mode=production && yarn run build:labextension","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","watch":"webpack --watch --mode=development","test":"echo \\"Error: no test specified\\" && exit 1"},"devDependencies":{"@jupyterlab/builder":"^4.0.0","rimraf":"^2.6.1","webpack":"^5.82.0","webpack-cli":"^5.0.2"},"dependencies":{"@deck.gl/core":"8.9.15","@deck.gl/google-maps":"8.9.15","@deck.gl/layers":"8.9.15","@deck.gl/mapbox":"8.9.15","@jupyter-widgets/base":"^2 || ^3 || ^4 || ^6","css-loader":"^4.2.2","d3":"5.0.0","d3-lasso":"^0.0.5","d3-tip":"^0.9.1","jupyterlab":"^0.17.5","lodash":"^4.17.4","mapbox-gl":"2.14.1","react":"18.2.0","style-loader":"^1.2.1"},"jupyterlab":{"extension":"lib/labplugin","outputDir":"../jupyter_d3_widget/labextension","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}');

/***/ })

}]);
//# sourceMappingURL=lib_index_js.47bdbe4ca3399ef628cb.js.map